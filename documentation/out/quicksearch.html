<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"client_lib_financiamento.js.html":{"id":"client_lib_financiamento.js.html","title":"Source: client/lib/financiamento.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/financiamento.js /** * @module client/lib/financiamento * * @description Financiamento da Educação * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ $(document).ready(function() { Plotly.setPlotConfig({locale: 'pt-BR'}) // Setando configuração de localidade para o Plugin Plotly (Gerador de gráficos). let feature; let dadosFinanciamento; let layer = L.geoJson(); let legend; const variables = { 'Percentual Certificado':'item2_perc_cert' } /** * @function getFeature * * @description Esta função é reponsável por capturar o objeto referente a área do município (feature) * do objeto geoJSON. * @param {Object} feature Área do município * @return {Object} Área do município. * */ function getFeature(feature){ return feature } /** * @function displayTabs * * @description Esta função controla os eventos de click das abas da tela de Financimento da Educação. * Ao clicar sobre uma determinada aba, as outras serão ocultadas e somente a clicada será exposta. * * * @param {HtmlElement} tab ID da aba clicada. * */ function displayTabs(tab){ switch(tab) { case 'grafico-tab': $('#home').hide(); $('#receita').show(); $('#despesa').hide(); $('#outras').hide(); break; case 'grafico-desp-tab': $('#home').hide(); $('#receita').hide(); $('#despesa').show(); $('#outras').hide(); break; case 'grafico-outra-tab': $('#home').hide(); $('#receita').hide(); $('#despesa').hide(); $('#outras').show(); break; default: $('#home').show(); $('#receita').hide(); $('#despesa').hide(); $('#outras').hide(); } } /** * @function addLegend * * @description Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. * * @param {Object} map Objeto Leaflet * */ function addLegend(map){ legend = L.control({position: 'bottomright'}); legend.onAdd = function (map) { var div = L.DomUtil.create('div', 'info legend'), grades = [0, 10, 20, 50, 100, 200, 500, 1000], labels = []; div.innerHTML = '&lt;span style=\"font-weight: 600;\"&gt;LEGENDA&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ff1a1a\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt; &lt; 25%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#29a329\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt; &amp;ge; 25%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ffb84d\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;Divergência entre TCM e STN&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#cca300\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;Sem certificação &lt;/span&gt;&lt;br&gt;' return div; }; legend.addTo(map); } /** * @function sliderStepDynamics * * @description Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Financimento da Educação. * Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente * ao ano selecionado. * * @param {Object} map Objeto Leaflet * */ function sliderStepDynamics(map){ stepSlider.noUiSlider.on('update', function (values, handle) { setLayer(map) }); } /** * @function getYear * * @description Esta função é reponsável por filtrar as informações do município pelo ano informado na chamada do método. * * @param {Array} list Lista com os municípios do estado * @param {Number} year Ano selecionado * @return {Array} Lista de informações do município filtradas por ano. * */ function getYear(list, year){ if(list === undefined) return -1 for(let i = 0; i &lt; list.length; i++){ if(list[i].ano == year) return list[i] } } /** * @function getStyleFromPercentualCertificado * * @description Esta função é reponsável por definir a cor da área (polígono) do município no mapa conforme o percentual certificado. * do objeto geoJSON. * * @param {Array} aggregateDataByyear Lista de informações do município filtradas por ano. * @param {Number} value Valor do percentual do município * @return {Object} Objeto com as informações do estilo do município. * */ function getStyleFromPercentualCertificado(aggregateDataByyear, value){ if(aggregateDataByyear[variables[value]] == 0 ) { return { opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#ffb84d\" }; }else if(aggregateDataByyear[variables[value]] == 1) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#cca300\" }; }else if(aggregateDataByyear[variables[value]] &gt;= 25){ return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#29a329\" }; } else if(aggregateDataByyear[variables[value]] &lt; 25) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#ff1a1a\" }; } } /** * @function styleMap * * @description Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. * * @param {Object} feat Feature do município. * @return {Object} Objeto com as informações do estilo do município. * */ function styleMap(feat){ let value = \"Percentual Certificado\" ; let year = stepSlider.noUiSlider.get(); let aggregateDataByyear = getYear(dadosFinanciamento[feat.properties.Nome], year); if(aggregateDataByyear === -1){ return { color: \"#0000FF\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#dddddd\" }; } if(dadosFinanciamento[feat.properties.Nome] !== undefined){ return getStyleFromPercentualCertificado(aggregateDataByyear, value); } } /** * @function getYearsFromMun * * @description Esta função responsável por filtrar da lista de informações classificadas por ano, * os anos de um determinado município. * * @param {Array} list Lista de informações do município. * @return {Array} Lista de anos do município. * */ function getYearsFromMun(list){ let years = []; for(let i = 0; i &lt; list.length; i++){ years.push(list[i].ano) } return years } /** * @function getReceitaMde * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Receita do MDE (item1_mde). * * @param {Array} list Lista de informações do município. * @return {Number} Valor da Receita do MDE. * */ function getReceitaMde(list){ let receitaMde = []; for(let i = 0; i &lt; list.length; i++){ receitaMde.push(list[i].item1_mde) } return receitaMde } /** * @function getReceitaFundeb * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Receita do FUNDEB (item1_fundeb). * * @param {Array} list Lista de informações do município. * @return {Number} Valor da Receita do FUNDEB. * */ function getReceitaFundeb(list){ let receitaFundeb = []; for(let i = 0; i &lt; list.length; i++){ receitaFundeb.push(list[i].item1_fundeb) } return receitaFundeb } /** * @function getDespesaMdeEducacaoInfantil * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Despesa do MDE em Educação Infantil (itens3e4_mde_edu_inf). * * @param {Array} list Lista de informações do município. * @return {Number} Valor da Despesa do MDE em Educação Infantil. * */ function getDespesaMdeEducacaoInfantil(list){ let despesaMdeEducacaoInfantil = []; for(let i = 0; i &lt; list.length; i++){ despesaMdeEducacaoInfantil.push(list[i].itens3e4_mde_edu_inf) } return despesaMdeEducacaoInfantil } /** * @function getDespesaMdeEducacaoFundamental * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Despesa do MDE em Educação Fundamental (itens3e4_mde_edu_fun). * * @param {Array} list lista de informações do município. * @return {Number} Valor da Despesa do MDE em Educação Fundamental. * */ function getDespesaMdeEducacaoFundamental(list){ let despesaMdeEducacaoFundamental = []; for(let i = 0; i &lt; list.length; i++){ despesaMdeEducacaoFundamental.push(list[i].itens3e4_mde_edu_fun) } return despesaMdeEducacaoFundamental } /** * @function getDespesaFundebPagMagisterio * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Despesa do FUNDEB com Magistério (itens3e4_fundeb_pag_mag). * * @param {Array} list Lista de informações do município. * @return {Number} Valor da Despesa do FUNDEB com Magistério. * */ function getDespesaFundebPagMagisterio(list){ let despesaFundebPagMagisterio = []; for(let i = 0; i &lt; list.length; i++){ despesaFundebPagMagisterio.push(list[i].itens3e4_fundeb_pag_mag) } return despesaFundebPagMagisterio } /** * @function getDespesaFundebOutrasDespesas * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Despesa do FUNDEB com Outras Despesas (itens3e4_fundeb_outras_desp). * * @param {Array} list Lista de informações do município. * @return {Number} Valor da Despesa do FUNDEB com Outras Despesas. * */ function getDespesaFundebOutrasDespesas(list){ let despesaFundebOutrasDespesas = []; for(let i = 0; i &lt; list.length; i++){ despesaFundebOutrasDespesas.push(list[i].itens3e4_fundeb_outras_desp) } return despesaFundebOutrasDespesas } /** * @function getDeducoesConstituicionais * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Deduções Constitucionais (dedu_const). * * @param {Array} list lista de informações do município. * @return {Number} Valor das Deduções Constitucionais. * */ function getDeducoesConstituicionais(list){ let deducoesConstituicionais = []; for(let i = 0; i &lt; list.length; i++){ deducoesConstituicionais.push(list[i].dedu_const) } return deducoesConstituicionais } /** * @function getPercentualCertificado * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente a Pecentual Certificado (item2_perc_cert). * * @param {Array} list Lista de informações do município. * @return {Number} Valor do Percentual Certificado. * */ function getPercentualCertificado(list){ let percentualCertificado = []; for(let i = 0; i &lt; list.length; i++){ percentualCertificado.push(list[i].item2_perc_cert) } return percentualCertificado } /** * @function chartMaker * * @description Esta função é responsável por gerar o gráfico de Receitas do MDE e FUNDEB do município * */ function chartMaker(){ let municipalitie = $( \"#municipality\" ).val(); //let variableValues = Object.values(variables); let years = getYearsFromMun(dadosFinanciamento[municipalitie]) let receitasMde = getReceitaMde(dadosFinanciamento[municipalitie]) let receitasFundeb = getReceitaFundeb(dadosFinanciamento[municipalitie]) var trace1 = { x: years, y: receitasMde, type: 'scatter', hoverinfo: 'y', name: 'MDE', marker: { line: { width: 10 } } }; var trace2 = { x: years, y: receitasFundeb, type: 'scatter', hoverinfo:'y', name: 'FUNDEB', marker: { line: { width: 10 } } }; var layout = { title: \"&lt;b&gt;Receitas do MDE e FUNDEB do município de \" + municipalitie + \"&lt;b&gt;\", showlegend: true, xaxis:{ nticks: 2, tickformat: 'Y', hoverformat: 'Y' }, yaxis:{ tickformat: ',.00' }, titlefont: { size: 18, family: 'BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif' } }; var data = [trace1, trace2]; Plotly.newPlot('myDiv', data, layout, {locale: 'pt-BR', responsive: true}); /** * @function toImage * @description O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF * do relatório do Financimento da Educação - Receitas do MDE e FUNDEB. * Será criado um input do tipo hidden * para guardar essa string e posteriormente ser capturada pelo gerador de PDF. * @return {Text} Imagem em base64 */ Plotly.toImage('myDiv',{format:'jpeg', height:600, width:680}).then(function(response){ response = JSON.stringify(response); $( \"#graficoReceitas\" ).remove(); $( \"#myDiv\" ).append(\"&lt;input type='hidden' id='graficoReceitas' name='graficoReceitas' value=\"+response+\"&gt;\"); }); } /** * @function chartMakerDepesasEducacao * * @description Esta função é responsável por gerar o gráfico de Despesas do MDE e FUNDEB do município * */ function chartMakerDepesasEducacao(){ let municipalitie = $( \"#municipality\" ).val(); let years = getYearsFromMun(dadosFinanciamento[municipalitie]) let despesaMdeEducacaoInfantil = getDespesaMdeEducacaoInfantil(dadosFinanciamento[municipalitie]) let despesaMdeEducacaoFundamental = getDespesaMdeEducacaoFundamental(dadosFinanciamento[municipalitie]) let despesaFundebPagMagisterio = getDespesaFundebPagMagisterio(dadosFinanciamento[municipalitie]) let despesaFundebOutrasDespesas = getDespesaFundebOutrasDespesas(dadosFinanciamento[municipalitie]) let deducoesConstituicionais = getDeducoesConstituicionais(dadosFinanciamento[municipalitie]) var trace1 = { x: years, y: despesaMdeEducacaoInfantil, type: 'scatter', hoverinfo: 'y', name: 'Educação Infantil', marker: { line: { width: 10 } } }; var trace2 = { x: years, hoverinfo: 'y', y: despesaMdeEducacaoFundamental, type: 'scatter', name: 'Educação Fundamental', marker: { line: { width: 10 } } }; var trace3 = { x: years, hoverinfo: 'y', y: despesaFundebPagMagisterio, type: 'scatter', name: 'Pagamentos Magistério', marker: { line: { width: 10 } } }; var trace4 = { x: years, hoverinfo: 'y', y: despesaFundebOutrasDespesas, type: 'scatter', name: 'Outras Despesas', marker: { line: { width: 10 } } }; var trace5 = { x: years, hoverinfo: 'y', y: deducoesConstituicionais, type: 'scatter', name: 'Dedução Constitucional', marker: { line: { width: 10 } } }; var layout = { title: \"&lt;b&gt;Despesas do MDE e FUNDEB do município de \" + municipalitie + \"&lt;b&gt;\", showlegend: true, xaxis:{ nticks: 2, tickformat: 'Y', hoverformat: 'Y' }, yaxis:{ tickformat: ',.00' }, titlefont: { size: 18, family: 'BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif' } }; var data = [trace1, trace2, trace3, trace4, trace5]; Plotly.newPlot('despesa', data, layout, {locale: 'pt-BR', responsive: true}); /** * @function toImage * @description O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF * do relatório do Financimento da Educação - Despesas do MDE e FUNDEB. * Será criado um input do tipo hidden * para guardar essa string e posteriormente ser capturada pelo gerador de PDF. * @return {Text} Imagem em base64 */ Plotly.toImage('despesa',{format:'jpeg', height:500, width:700}).then(function(response){ response = JSON.stringify(response); $( \"#graficoDespesas\" ).remove(); $( \"#despesa\" ).append(\"&lt;input type='hidden' id='graficoDespesas' name='graficoDespesas' value=\"+response+\"&gt;\"); }); } /** * @function chartMakerOutrasInformacoes * * @description Esta função é responsável por gerar o gráfico de Percentual Certificado do município * */ function chartMakerOutrasInformacoes(){ let municipalitie = $( \"#municipality\" ).val(); let years = getYearsFromMun(dadosFinanciamento[municipalitie]) let percentualCertificado = getPercentualCertificado(dadosFinanciamento[municipalitie]) var trace1 = { x: years, y: percentualCertificado, type: 'scatter', name: 'Percentual Certificado', marker: { line: { width: 10 } } }; var layout = { title: \"&lt;b&gt;Percentual Certificado do município de \" + municipalitie + \"&lt;b&gt;\", showlegend: true, xaxis:{ nticks: 2, tickformat: 'Y', hoverformat: 'Y' }, titlefont: { size: 18, family: 'BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif' } }; var data = [trace1]; Plotly.newPlot('outras', data, layout, {locale: 'pt-BR', responsive: true}); /** * @function toImage * @description O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF * do relatório do Financimento da Educação - Percentual Certificado. * Será criado um input do tipo hidden * para guardar essa string e posteriormente ser capturada pelo gerador de PDF. * @return {Text} Imagem em base64 */ Plotly.toImage('outras',{format:'jpeg', height:500, width:700}).then(function(response){ response = JSON.stringify(response); $(\"#graficoOutrasInfo\").remove(); $(\"#outras\").append(\"&lt;input type='hidden' id='graficoOutrasInfo' name='graficoOutrasInfo' value=\"+response+\"&gt;\"); }); } /** * @function componentMaker * * @description Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no * banco de dados. * */ function componentMaker(mymap){ let years = [] let municipalitie = feature[0].properties.Nome; let filtredFinanciamento = dadosFinanciamento[municipalitie]; $(\"#municipality\").val(municipalitie); let selectVariable = $('#variable'); selectVariable.append($(\"&lt;option/&gt;\").val(filtredFinanciamento[0].item2_perc_cert).text(\"Percentual Certificado\")); let count = 0; for(let i = 0; i &lt; filtredFinanciamento.length; i++){ years.push(filtredFinanciamento[i].ano) count++ } let min = Math.min.apply(Math, years) let max = Math.max.apply(Math, years) noUiSlider.create(stepSlider, { step: 1, snap: true, format: { to: function ( value ) { return value; }, from: function ( value ) { return value.replace(',-', ''); } }, tooltips:true, start: [ min ], pips: { mode: 'steps', stepped: true, density: 12, values: count }, range: { min: min, max: max }, }); sliderStepDynamics(mymap) poligonMap(mymap) } /** * @function calculaDifMdeEFundeb * * @description Esta função responsável por calcular a diferença entre os valores despesa de educação infantil e fundamental. * Essa informação será exibido quando o usuário pairar o cursor do mouse sobre os valores de educação infantil e fundamental * na janela de informações do município. * * @param {Number} eduInf Valor da despesa de Educação Infantil. * @param {Number} eduFun Valor da despesa de Educação Fundamental. * @return {Text} Html com resultado dentro de um componente tooltip. * */ function calculaDifMdeEFundeb(eduInf, eduFun){ var diferenca = 0; var percDif = 0; if(eduInf &gt; eduFun){ diferenca = eduInf - eduFun; percDif = (diferenca / eduInf) * 100; }else{ diferenca = eduFun - eduInf; percDif = (diferenca / eduFun) * 100; } return \" data-toggle='tooltip' \" + \" data-html='true' \" + \" title='Diferença entre as depesas de Educação Infantil e Educação Fundamental: R$ \"+converterFloatReal(diferenca.toFixed(2))+\". Percentual da diferença: \"+converterFloatReal(percDif.toFixed(2))+\"%'\"; } /** * @function getColorFromPercentual * * @description Esta função responsável por definir a cor do valor de Percentual Certificado na janela de informações do município. * * @param {Number} perc Valor do percentual certificado do municipio. * @return {Text} Cor conforme percentual informando * */ function getColorFromPercentual(perc){ if(perc &gt;= 25){ return \"#29a329\"; }else if(perc &lt; 25) { return \"#ff1a1a\"; }else{ return \"black\"; } } /** * @function montaTabelaPopUpFinanciamento * * @description Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. * * @param {Array} aggregateDataByyear Lista de informações do município filtradas por ano. * @param {Object} la (layer) camada de exibição do mapa. * @return {text} Tabela em html com as informaçãos do município. * */ function montaTabelaPopUpFinanciamento(aggregateDataByyear, la){ if(aggregateDataByyear.item2_perc_cert == 1){ return \"&lt;b class='titleMunicipio' &gt;Ano: \"+aggregateDataByyear.ano+\" - Município: \"+la.feature.properties.Nome+\"&lt;/b&gt; &lt;p align='center'&gt;Informações sem certificação em função da &lt;br&gt;ausência da prestação de contas de todos os meses do período.&lt;/p&gt;\"; }else if (aggregateDataByyear.item2_perc_cert == 0){ return \" &lt;b class='titleMunicipio' &gt;Ano: \"+aggregateDataByyear.ano+\" - Município: \"+la.feature.properties.Nome+\" &lt;/b&gt; &lt;p align='center'&gt;Informações zeradas em função de divergência &lt;br&gt; entre valores informados ao TCM e STN.&lt;/p&gt;\"; }else if(aggregateDataByyear.item2_perc_cert == undefined){ return la.feature.properties.Nome+\" &lt;/b&gt; &lt;p align='center'&gt;Sem Informações.&lt;/p&gt;\"; } return \"&lt;table style='font-size: 12.5px;' class='table table-responsive'&gt;\" + \"&lt;thead&gt;\" + \"&lt;tr&gt;\" + \"&lt;th colspan='2' class='titleMunicipio' align='center' scope='col'&gt;Ano: \"+aggregateDataByyear.ano+\" - Município: \"+la.feature.properties.Nome+\" &lt;/th&gt; \" + \"&lt;/tr&gt;\" + \"&lt;/thead&gt;\" + \"&lt;tbody&gt;\" + \"&lt;tr&gt;\" + \"&lt;td colspan='2' align='center' style='font-weight: bold;' &gt;Receitas&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;MDE &lt;/td&gt;\" + \"&lt;td align='right' &gt;\"+converterFloatReal(aggregateDataByyear.item1_mde)+\"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;FUNDEB &lt;/td&gt;\" + \"&lt;td align='right' &gt;\"+converterFloatReal(aggregateDataByyear.item1_fundeb)+\"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td colspan='2' align='center' style='font-weight: bold;' &gt;Despesas&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;MDE Educação Infantil &lt;/td&gt;\" + \"&lt;td align='right' \"+ calculaDifMdeEFundeb(aggregateDataByyear.itens3e4_mde_edu_inf, aggregateDataByyear.itens3e4_mde_edu_fun)+\" &gt;\"+converterFloatReal(aggregateDataByyear.itens3e4_mde_edu_inf)+\"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;MDE Educação Fundamental &lt;/td&gt;\" + \"&lt;td align='right' \"+ calculaDifMdeEFundeb(aggregateDataByyear.itens3e4_mde_edu_inf, aggregateDataByyear.itens3e4_mde_edu_fun)+\" &gt;\"+converterFloatReal(aggregateDataByyear.itens3e4_mde_edu_fun)+\"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;FUNDEB Pagamentos Magistério &lt;/td&gt;\" + \"&lt;td align='right'&gt;\"+ converterFloatReal(aggregateDataByyear.itens3e4_fundeb_pag_mag)+\"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;FUNDEB Outras Despesas &lt;/td&gt;\" + \"&lt;td align='right'&gt;\"+ converterFloatReal(aggregateDataByyear.itens3e4_fundeb_outras_desp)+\"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Dedução Constitucional&lt;/td&gt;\" + \"&lt;td align='right'&gt;\"+converterFloatReal(aggregateDataByyear.dedu_const)+\"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td colspan='2'&gt;&amp;nbsp;&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Percentual Certificado&lt;/td&gt;\" + \"&lt;td style='font-weight: bold; color:\"+getColorFromPercentual(aggregateDataByyear.item2_perc_cert)+\"' align='right'&gt;\"+ converterFloatReal(aggregateDataByyear.item2_perc_cert)+\"%&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/tbody&gt;\" + \"&lt;/table&gt;\"; } /** * @function poligonMap * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. * * @param {Object} map Objeto Leaflet. * */ function poligonMap(map){ layer.addData(feature); layer.eachLayer(function (la) { let year = stepSlider.noUiSlider.get(); let value = \"Percentual Certificado\"; let aggregateDataByyear = getYear(dadosFinanciamento[la.feature.properties.Nome], year); let popUpDadosMunicipio = new L.Popup({closeOnClick: false, autoClose: false}) .setContent(montaTabelaPopUpFinanciamento(aggregateDataByyear, la)); la.bindPopup(popUpDadosMunicipio); setEventMouseOverOnLayer(la, map); }); layer.addTo(map); layer.setStyle(styleMap); } /** * @function setLayer * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, * quando houver troca de ano. * * @param {Object} map Objeto Leaflet. * */ function setLayer(map){ $(\".noUi-tooltip\").prepend(\"&lt;div class='titleAno'&gt;Ano: &lt;/div&gt;\"); layer.eachLayer(function (la) { let year = Math.floor(stepSlider.noUiSlider.get()); let value = \"Percentual Certificado\"; let aggregateDataByyear = getYear(dadosFinanciamento[la.feature.properties.Nome], year); la.bindPopup(montaTabelaPopUpFinanciamento(aggregateDataByyear, la)) }); layer.setStyle(styleMap); } /** * @function initMap * * @description Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, * neste caso, na div identificada pelo id mapid. * * @param {Object} map Objeto Leaflet. * */ function initMap(feature){ let mymap = L.map('mapid').setView([-16.361508, -49.500561], 6.40); mymap.createPane('labels'); mymap.getPane('labels').style.zIndex = 800; L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg', { attribution: 'CAO Educação e UTP Geoprocessamento - CATEP', maxZoom: 18, minZoom: 5, id: 'mapbox.light', accessToken: 'pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg' }).addTo(mymap); $(window).on(\"resize\", function () { $(\"#mapid\").height($(window).height()-400); mymap.invalidateSize(); }).trigger(\"resize\"); mymap.addControl(new L.Control.Fullscreen()); return mymap; } const stepSlider = document.getElementById('slider-step'); /** * @function promise * * @description O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise * que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, * busca-se os dados do financimento da educação e depois é realizado a ordenação deles. * */ const promise = new Promise(function(resolve, reject) { const municipalities = $.get({ url: \"/geojson\", dataType:\"json\", success: function(polygons){} }); const dadosfinanciamento = $.get({ url: \"/financiamento\", dataType:\"json\", success: function(dadosfinanciamento){} }); $.when( municipalities, dadosfinanciamento ).done(function (polygons, dadosfinanciamento) { dadosFinanciamento = dadosfinanciamento[0] feature = polygons[0].features.filter(getFeature); feature.sort(function(a,b) {return (a.properties.Nome &gt; b.properties.Nome) ? 1 : ((b.properties.Nome &gt; a.properties.Nome) ? -1 : 0);} ); resolve(); }); }); /** * Após a organização dos dados pelo código acima, será chamado as funções que realizam os procedimentos * de configuração para exbição das informações dos municípios do estado. * */ promise.then(function() { let mymap = initMap(feature); componentMaker(mymap) addLegend(mymap) chartMaker() chartMakerDepesasEducacao() chartMakerOutrasInformacoes() return mymap }).then(function(mymap){ /** * script para habilitar o tooltip * */ $(function () { $('[data-toggle=\"tooltip\"]').tooltip() }) /** * Este script monitora qualquer mudança na barra de anos, caso haja alguma alteração será chamada a função * seta as informação para o ano corresponte. * */ $('#slider-pips').slider({ change: function(event, ui) { setLayer(mymap) } }) /** * Este script monitora os eventos de seleção e focus do campo Busca por Município, caso seja digitado algum texto * será retornado os municípios de contenham o texo infomado. */ $(\"#municipality\").autocomplete({ source: Object.keys(dadosFinanciamento), select: function( event, ui ) { chartMaker() chartMakerDepesasEducacao() chartMakerOutrasInformacoes() }, focus: function(e,ui){ $(this).val(ui.item.label); return false; } }) /** * Este script monitora os eventos de clique no botão Exibir Município Selecionado, caso haja algum clique nesse botão, * será será exibido o município seleciondo juntamente com suas informações. */ let layerSelected; $( \"#zoomin\" ).click(function() { let municipalitie = $( \"#municipality\" ).val(); layer.eachLayer(function (lay) { if(lay.feature.properties.Nome === municipalitie){ layerSelected = lay.setStyle({ 'color': 'blue', 'weight': 5, 'opacity': 2 }); mymap.fitBounds(lay.getBounds()); layerSelected.openPopup() } }); }) /** * * Código para capturar o evento de click nas abas da tela de Financimento da Educação. * */ $(\".nav-link\").on('click', function(){ displayTabs(this.id) chartMaker() chartMakerDepesasEducacao() chartMakerOutrasInformacoes() }) // /** // * Código para capturar o evento de click nas abas da tela e chama os métodos de criação dos gráficos // */ // $(\".nav-item\").on('click', function(){ // chartMaker() // chartMakerDepesasEducacao() // chartMakerOutrasInformacoes() // }) /** * Este script monitora os eventos de clique no botão Limpar Seleção, caso haja algum clique nesse botão, * será removida a seleção do município e a visão do mapa sera ampliada. */ $( \"#zoomout\" ).click(function() { let municipalitie = $(\"#municipality\").val(); mymap.setView([-16.361508, -49.500561], 6.40); layerSelected.setStyle({ color: \"#000000\", opacity: 0.2, weight: 4 }); layerSelected.closePopup() }) /** * Este script monitora os eventos de clique no botão Gerar Relatório PDF, caso haja algum clique nesse botão, * será acionado o programa que gerará o Relatório do Financimento da Educação em PDF. */ $(\"#gerarPdf\").click(function() { let municipalitie = $(\"#municipality\").val(); geraPDF(dadosFinanciamento[municipalitie], municipalitie); }) }); }); × Search results Close "},"client_lib_ideb.js.html":{"id":"client_lib_ideb.js.html","title":"Source: client/lib/ideb.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/ideb.js /** * @module client/lib/ideb * * @description Dados do IDEB * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ $(document).ready(function() { Plotly.setPlotConfig({ locale: 'pt-BR' }) // Setando configuração de localidade para o Plugin Plotly (Gerador de gráficos). let feature; let dadosIdeb; let layer = L.geoJson(); let legend; const variables = { 'Atingiu a meta': 'atingiu_meta' } /** * @function getFeature * * @description Esta função é reponsável por capturar o objeto referente a área do município (feature) * do objeto geoJSON. * * @param {Object} feature Área do município * @return {Object} feature (área do município) * */ function getFeature(feature) { return feature } /** * @function getLegend * * @description Esta função é responsável por montar a legenda de dados do mapa. * * @return {text} legenda do mapa em html * */ function getLegend() { var legend; legend = '&lt;span style=\"font-weight: 600;\"&gt;LEGENDA&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#00cc00\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;Atendeu meta&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#e62e00\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;Não atendeu meta&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#dddddd\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;Sem Informações&lt;/span&gt;&lt;br&gt;' return legend; } /** * @function addLegend * * @description Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. * * @param {Object} map Objeto Leaflet * */ function addLegend(map) { legend = L.control({ position: 'bottomright' }); legend.onAdd = function(map) { var div = L.DomUtil.create('div', 'info legend'), grades = [0, 10, 20, 50, 100, 200, 500, 1000], labels = ['Legenda']; div.innerHTML = getLegend(); return div; }; legend.addTo(map); } /** * @function sliderStepDynamics * * @description Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Financimento da Educação. * Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente * ao ano selecionado. * * @param {Object} map Objeto Leaflet * */ function sliderStepDynamics(map) { stepSlider.noUiSlider.on('update', function(values, handle) { setLayer(map) }); } /** * @function getYear * * @description Esta função é reponsável por filtrar as informações do município pelo ano informado e pela classe (Etapa Escolar) * na chamada do método. * * @param {Array} list Lista com os municípios do estado * @param {Number} year Ano selecionado * @return {Array} list lista de informações do município filtradas por ano. * */ function getYear(list, year) { var classe = $(\"#classe option:selected\").val(); year = parseInt(year); var munSemValores = 0; var qtdeMun; if (list === undefined) { munSemValores++; return -1 } var muns = []; for (let i = 0; i &lt; list.length; i++) { if (year === undefined) { return -1; } else { if (list[i].ano == year &amp;&amp; classe == list[i].classe) { return list[i]; } } } } /** * @function getStyleAtingiuMeta * * @description Esta função é reponsável por definir a cor da área (polígono) do município no mapa. * * @param {Array} aggregateDataByyear Lista de informações do município filtradas por ano. * @return {Object} Objeto com as informações do estilo do município. * */ function getStyleAtingiuMeta(aggregateDataByyear) { let value = \"Atingiu a meta\"; if (aggregateDataByyear[variables[value]] == 1) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#00cc00\" }; } else { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#e62e00\" }; } } /** * @function styleMap * * @description Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. * * @param {Object} feat Feature do município. * @return {object} Objeto com informações do estilo do município. * */ function styleMap(feat) { let year = stepSlider.noUiSlider.get(); let aggregateDataByyear = getYear(dadosIdeb[feat.properties.Nome], year); if (aggregateDataByyear === -1 || aggregateDataByyear == undefined) { return { color: \"#000000\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#dddddd\" }; } else if (aggregateDataByyear.indice &lt;= 0 &amp;&amp; aggregateDataByyear.meta &gt;= 0) { return { color: \"#000000\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#dddddd\" }; } if (dadosIdeb[feat.properties.Nome] !== undefined) { return getStyleAtingiuMeta(aggregateDataByyear); } } /** * @function getYearsFromMun * * @description Esta função responsável por filtrar da lista de informações classificadas por ano, * os anos de um determinado município. * * @param {Array} list Lista de informações do município. * @return {Array} Lista anos do município. * */ function getYearFromMun(list) { var classe = $(\"#classe option:selected\").val(); let years = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].classe == classe) { years.push(list[i].ano) } } return years } /** * @function getIDEB * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente da nota do IDEB (indice). * * * @param {Array} list Lista de informações do município. * @return {Number} Nota do IDEB. * */ function getIDEB(list) { var classe = $(\"#classe option:selected\").val(); let IDEB = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].classe == classe) { IDEB.push(list[i].indice) } } return IDEB } /** * @function getMeta * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente da meta do IDEB (meta). * * * @param {Array} list Lista de informações do município. * @return {Number} Meta do IDEB. * */ function getMeta(list) { var classe = $(\"#classe option:selected\").val(); let meta = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].classe == classe) { meta.push(list[i].meta) } } return meta } /** * @function getAtingiuMeta * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente do atributo atingiu nota (atingiu_meta). * * * @param {Array} list lista de informações do município. * @return {Text} Atributo que consta se a nota foi atingida ou não. * */ function getAtingiuMeta(list) { var classe = $(\"#classe option:selected\").val(); let atingiuMeta = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].classe == classe) { atingiuMeta.push(list[i].atingiu_meta) } } return atingiuMeta } /** * @function chartMaker * * @description Esta função é responsável por gerar o gráfico da situação do município no IDEB * */ function chartMaker() { let municipalitie = $(\"#municipality\").val(); let years = getYearFromMun(dadosIdeb[municipalitie]) let IDEB = getIDEB(dadosIdeb[municipalitie]) let meta = getMeta(dadosIdeb[municipalitie]) var trace1 = { x: years, y: IDEB, hoverinfo: 'y', type: 'scatter', name: ' IDEB', marker: { line: { width: 10 } } }; var trace2 = { x: years, y: meta, hoverinfo: 'y', type: 'scatter', name: ' meta', marker: { line: { width: 10 } } }; var layout = { title: \"&lt;b&gt; Situação do município \" + municipalitie + \" no IDEB&lt;b&gt;\", showlegend: true, xaxis: { tickformat: 'Y', hoverformat: 'Y' }, titlefont: { size: 16, family: 'Open Sans, verdana, arial, sans-serif' } }; var data = [trace1, trace2]; Plotly.newPlot('myDiv', data, layout, { locale: 'pt-BR', responsive: true }); /** * @function toImage * @description O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF * do relatório do IDEB. * Será criado um input do tipo hidden * para guardar essa string e posteriormente ser capturada pelo gerador de PDF. * @return {Text} Imagem em base64 */ Plotly.toImage('myDiv', { format: 'jpeg', height: 500, width: 950 }).then(function(response) { response = JSON.stringify(response); $(\"#graficoIdeb\").remove(); $(\"#myDiv\").append(\"&lt;input type='hidden' id='graficoIdeb' name='graficoIdeb' value=\" + response + \"&gt;\"); }); } /** * @function componentMaker * * @description Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no * banco de dados. * */ function componentMaker(mymap) { let years = [] let municipalitie = feature[0].properties.Nome; let filterDadosIdeb = dadosIdeb[municipalitie]; $(\"#municipality\").val(municipalitie); let count = 0; for (let i = 0; i &lt; filterDadosIdeb.length; i++) { years.push(filterDadosIdeb[i].ano) count++ } let min = Math.min.apply(Math, years) let max = Math.max.apply(Math, years) noUiSlider.create(stepSlider, { range: { min: min, max: max }, format: { to: function(value) { return value; }, from: function(value) { return value.replace(',-', ''); } }, tooltips: true, step: 2, start: [min], connect: true, behaviour: 'tap-drag', pips: { mode: 'steps', stepped: true, density: 12, values: count } }); sliderStepDynamics(mymap) poligonMap(mymap) } /** * @function getTextMeta * @param {Number} meta Valor da meta. * @return {Text} texto se meta for {0 - Não / 1 - Sim} * */ function getTextMeta(meta) { var texto; if (meta == 1) { texto = \"Sim\"; } else { texto = \"Não\"; } return texto; } /** * @function getColorFromMeta * * @param {Number} meta Valor da meta * @return {Text} Oor conforme a meta atingida ou não * */ function getColorFromMeta(meta) { if (meta == 1) { return \"#00cc00\"; } else { return \"#e62e00\"; } } /** * @function montaTabelaPopUpIdeb * * @description Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. * * @param {Array} aggregateDataByyear Lista de informações do município filtradas por ano. * @param {Object} la Camada (layer) de exibição do mapa * @return {Text} Tabela em html com as informaçãos do município. * */ function montaTabelaPopUpIdeb(aggregateDataByyear, la) { if (aggregateDataByyear == undefined || aggregateDataByyear == -1) { return \"&lt;b class='titleMunicipio'&gt;\" + la.feature.properties.Nome + \"&lt;/b&gt; &lt;p align='center'&gt;Sem Informações&lt;/p&gt;\"; } return \"&lt;table style='font-size: 12.5px;' class='table table-responsive'&gt; \" + \"&lt;thead&gt;\" + \"&lt;tr&gt;\" + \"&lt;th colspan='2' class='titleMunicipio' align='center' scope='col'&gt;Ano: \" + aggregateDataByyear.ano + \" - Município: \" + la.feature.properties.Nome + \" &lt;/th&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;th scope='col'&gt;IDEB&lt;/th&gt;\" + \"&lt;th scope='col'&gt;&lt;/th&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/thead&gt;\" + \"&lt;tbody&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Nota&lt;/td&gt;\" + \"&lt;td style='font-weight: bold; color:\" + getColorFromMeta(aggregateDataByyear.atingiu_meta) + \"' align='right'&gt;\" + converterFloatReal(aggregateDataByyear.indice) + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Meta&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + converterFloatReal(aggregateDataByyear.meta) + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Meta atingida?&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + getTextMeta(aggregateDataByyear.atingiu_meta) + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/tbody&gt;\" + \"&lt;/table&gt;\"; } /** * @function poligonMap * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. * * @param {Object} map Objeto Leaflet. * */ function poligonMap(map) { layer.addData(feature); layer.eachLayer(function(la) { let year = stepSlider.noUiSlider.get(); let aggregateDataByyear = getYear(dadosIdeb[la.feature.properties.Nome], year); la.bindPopup(montaTabelaPopUpIdeb(aggregateDataByyear, la)) setEventMouseOverOnLayer(la, map) }); layer.addTo(map); layer.setStyle(styleMap); } /** * @function setLayer * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, * quando houver troca de ano. * * @param {Object} map Objeto Leaflet. * */ function setLayer(map) { $(\".titleAno\").remove(); $(\".noUi-tooltip\").prepend(\"&lt;div class='titleAno'&gt;Ano: &lt;/div&gt;\"); layer.eachLayer(function(la) { let year = Math.floor(stepSlider.noUiSlider.get()); let aggregateDataByyear = getYear(dadosIdeb[la.feature.properties.Nome], year); la.bindPopup(montaTabelaPopUpIdeb(aggregateDataByyear, la)) setEventMouseOverOnLayer(la, map) }); layer.setStyle(styleMap) } /** * @function initMap * * @description Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, * neste caso, na div identificada pelo id mapid. * * @param {Object} map Objeto Leaflet. * */ function initMap(feature) { let mymap = L.map('mapid').setView([-16.361508, -49.500561], 6.40); mymap.createPane('labels'); mymap.getPane('labels').style.zIndex = 800 /*650*/ ; L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg', { attribution: 'CAO Educação e UTP Geoprocessamento - CATEP', maxZoom: 18, minZoom: 3, id: 'mapbox.light', accessToken: 'pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg' }).addTo(mymap); $(window).on(\"resize\", function() { $(\"#mapid\").height($(window).height() - 400); mymap.invalidateSize(); }).trigger(\"resize\"); mymap.addControl(new L.Control.Fullscreen()); return mymap; } const stepSlider = document.getElementById('slider-step'); /** * @function promise * * @description O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise * que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, * busca-se os dados do IDEB e depois será realizado a ordenação deles. * */ const promise = new Promise(function(resolve, reject) { const municipalities = $.get({ url: \"/geojson\", dataType: \"json\", success: function(polygons) {} }); const dadosideb = $.get({ url: \"/ideb\", dataType: \"json\", success: function(dadosideb) {} }); $.when(municipalities, dadosideb).done(function(polygons, dadosideb) { dadosIdeb = dadosideb[0] feature = polygons[0].features.filter(getFeature); feature.sort(function(a, b) { return (a.properties.Nome &gt; b.properties.Nome) ? 1 : ((b.properties.Nome &gt; a.properties.Nome) ? -1 : 0); }); resolve(); }); }); /** * Após a organização dos dados pelo código acima, será chamado as funções que realizam os procedimentos * de configuração para exbição das informações dos municípios do estado. * */ promise.then(function() { let mymap = initMap(feature); componentMaker(mymap) addLegend(mymap) chartMaker() return mymap }).then(function(mymap) { /** * Este script monitora qualquer mudança na barra de anos, caso haja alguma alteração será chamada a função * seta as informação para o ano corresponte. * */ $('#slider-pips').slider({ change: function(event, ui) { setLayer(mymap) } }) /** * Este script monitora os eventos de seleção caixa de seleção Etapa Escolar, caso haja alguma mudança * será montada uma nova camada no mapa com as informações selecioandas. */ let municipalitie = $(\"#municipality\").val(); $(\"#classe\").change(function() { legend.remove(mymap); addLegend(mymap); setLayer(mymap); chartMaker(); }); /** * Este script monitora os eventos de seleção e focus do campo Busca por Município, caso seja digitado algum texto * será retornado os municípios de contenham o texo infomado. */ $(\"#municipality\").autocomplete({ source: Object.keys(dadosIdeb), select: function(event, ui) { chartMaker() }, focus: function(e, ui) { $(this).val(ui.item.label); return false; } }) /** * Este script monitora os eventos de clique no botão Exibir Município Selecionado, caso haja algum clique nesse botão, * será será exibido o município seleciondo juntamente com suas informações. */ let layerSelected; $(\"#zoomin\").click(function() { let municipalitie = $(\"#municipality\").val(); layer.eachLayer(function(lay) { if (lay.feature.properties.Nome === municipalitie) { layerSelected = lay.setStyle({ color: 'blue', weight: 5, opacity: 2, }); mymap.fitBounds(lay.getBounds()); layerSelected.openPopup() } }); }) /** * Este script monitora os eventos de clique no botão Limpar Seleção, caso haja algum clique nesse botão, * será removida a seleção do município e a visão do mapa sera ampliada. */ $(\"#zoomout\").click(function() { let municipalitie = $(\"#municipality\").val(); mymap.setView([-16.361508, -49.500561], 6.40); layerSelected.setStyle({ color: \"#000000\", weight: 4, opacity: 0.2 }); layerSelected.closePopup() }) /** * Código para capturar o evento de click nas abas da tela e chama o método de criação do gráfico */ $(\"#grafico-tab\").on('click', function() { chartMaker() }) /** * @function getMunicipioPorClasse * * @description Esta função responsável por filtar municipios por classe (Etapa Escolar) * * @param {Obejct} mun Objeto do municipio * @return {Boolean} true / false * */ function getMunicipioPorClasse(mun) { var classe = $(\"#classe option:selected\").val(); return mun.classe == classe; } /** * Este script monitora os eventos de clique no botão Gerar Relatório PDF, caso haja algum clique nesse botão, * será acionado o programa que gerará o Relatório do IDEB em PDF. */ $(\"#gerarPdf\").click(function() { let municipalitie = $(\"#municipality\").val(); var classe = $(\"#classe option:selected\").text(); geraPDF(dadosIdeb[municipalitie].filter(getMunicipioPorClasse), municipalitie, classe); }) }); }); × Search results Close "},"client_lib_matriculas.js.html":{"id":"client_lib_matriculas.js.html","title":"Source: client/lib/matriculas.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/matriculas.js /** * @module client/lib/matriculas * * @description Matrículas da Educação Infantil * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ $(document).ready(function() { Plotly.setPlotConfig({ locale: 'pt-BR' }) // Setando configuração de localidade para o Plugin Plotly (Gerador de gráficos). let feature; let mpData; let layer = L.geoJson(); let legend; const variables = { 'Creches': 'Mat_Creche_Per', 'Pré-escolas': 'Mat_Pre_Esc_Per' } /** * @function getFeature * * @description Esta função é reponsável por capturar o objeto referente a área do município (feature) * do objeto geoJSON. * * @param {Object} feature Área do município * @return {Object} Área do município. * */ function getFeature(feature) { return feature } /** * @function addLegend * * @description Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. * * @param {Object} map Objeto Leaflet * */ function addLegend(map) { legend = L.control({ position: 'bottomright' }); legend.onAdd = function(map) { var div = L.DomUtil.create('div', 'info legend'), grades = [0, 10, 20, 50, 100, 200, 500, 1000], labels = []; if ($(\"#variable option:selected\").text() === 'Creches') { div.innerHTML = '&lt;span style=\"font-weight: 600;\"&gt;LEGENDA&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#b30000\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt; &lt; 10%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ff1a1a\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;10-20%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ff8080\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;20-30%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#cca300\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;30-40%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ffff00\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;40-50%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#29a329\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt; &amp;ge; 50%&lt;/span&gt;&lt;br&gt;' } else { div.innerHTML = '&lt;span style=\"font-weight: 600;\"&gt;LEGENDA&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#b30000\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt; &lt; 20%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ff1a1a\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;20-40%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ff8080\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;40-50%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#cca300\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;50-60%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ffff00\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;60-80%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#29a329\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;80-100%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#076d2b\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt; &gt; 100%&lt;/span&gt;&lt;br&gt;' } return div; }; legend.addTo(map); } /** * @function sliderStepDynamics * * @description Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Matrículas da Educação Infantil * Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente * ao ano selecionado. * * @param {Object} map Objeto Leaflet * */ function sliderStepDynamics(map) { stepSlider.noUiSlider.on('update', function(values, handle) { setLayer(map) }); } /** * @function getYear * * @description Esta função é reponsável por filtrar as informações do município pelo ano informado na chamada do método. * * @param {Array} list Lista com os municípios do estado * @param {Number} year Ano selecionado * @return {Array} Lista de informações do município filtradas por ano. * */ function getYear(list, year) { if (list === undefined) return -1 for (let i = 0; i &lt; list.length; i++) { if (list[i].Ano == year) return list[i] } } /** * @function getStyleFromTypeMatricula * * @description Esta função é reponsável por definir a cor da área (polígono) do município no mapa conforme o tipo de matrícula . * * @param {Array} aggregateDataByyear Lista de informações do município filtradas por ano. * @param {Number} value Valor do percentual selecionado. * * @return {Object} Objeto com Parâmetros para estilização das áres dos municípios. * */ function getStyleFromTypeMatricula(aggregateDataByyear, value) { /** * Este teste é necessário pois as taxas e as tonalidades das cores mudam de acordo com * o tipo de matrícula foi selecionado. */ if (value === 'Creches') { //Este trecho irá configuarar as cores e taxas das matrículas Creches if (aggregateDataByyear[variables[value]] &gt;= 50) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#29a329\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 40 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 50) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#ffff00\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 30 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 40) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#cca300\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 20 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 30) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#ff8080\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 10 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 20) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#ff1a1a\" }; } else if (aggregateDataByyear[variables[value]] &lt; 10) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#b30000\" }; } } else { //Este trecho irá configuarar as cores e taxas das matrículas Pré-escolas if (aggregateDataByyear[variables[value]] &gt; 100) { return { color: \"#000000\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#076d2b\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 80 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 100) { return { color: \"#000000\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#29a329\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 60 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 80) { return { color: \"#000000\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#ffff00\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 50 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 60) { return { color: \"#000000\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#cca300\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 40 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 50) { return { color: \"#000000\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#ff8080\" }; } else if (aggregateDataByyear[variables[value]] &gt;= 20 &amp;&amp; aggregateDataByyear[variables[value]] &lt; 40) { return { color: \"#000000\", opacity: 0.2, weight: 4, fillOpacity: 1.9, fillColor: \"#ff1a1a\" }; } else if (aggregateDataByyear[variables[value]] &lt; 20) { return { color: \"#000000\", opacity: 0.2, weight: 4, fillOpacity: 1.9, fillColor: \"#b30000\" }; } } } /** * @function styleMap * * @description Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. * * @param {object} feat Feature do município. * * @return {object} Objeto com informações do estilo do município. * */ function styleMap(feat) { let value = $(\"#variable option:selected\").text() let year = stepSlider.noUiSlider.get(); let aggregateDataByyear = getYear(mpData[feat.properties.Nome], year); if (aggregateDataByyear === -1) { return { color: \"#0000FF\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#dddddd\" }; } if (mpData[feat.properties.Nome] !== undefined) { return getStyleFromTypeMatricula(aggregateDataByyear, value); } } /** * @function getYearsFromMun * * @description Esta função responsável por filtrar da lista de informações classificadas por ano, * os anos de um determinado município. * * @param {Array} list Lista de informações do município. * @return {Array} Lista anos do município. * */ function getYearFromMun(list) { let years = []; for (let i = 0; i &lt; list.length; i++) { years.push(list[i].Ano) } return years } /** * @function getCreche * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente ao percentual de matrículas em creches (Mat_Creche_Per). * * @param {Array} list Lista de informações do município. * @return {Number} Percentual de matrículas em creches. * */ function getCreche(list) { let creche = []; for (let i = 0; i &lt; list.length; i++) { creche.push(list[i].Mat_Creche_Per) } return creche } /** * @function getPreEscola * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente ao percentual de matrículas em pré-escolas (Mat_Pre_Esc_Per). * * @param {Array} list Lista de informações do município. * @return {Number} Percentual de matrículas em pré-escolas. * */ function getPreEscola(list) { let preEscola = []; for (let i = 0; i &lt; list.length; i++) { preEscola.push(list[i].Mat_Pre_Esc_Per) } return preEscola } /** * @function chartMaker * * @description Esta função é responsável por gerar o gráfico de Percentuais de matrículas Creches e Pré-escolas do município * */ function chartMaker() { let municipalitie = $(\"#municipality\").val(); let years = getYearFromMun(mpData[municipalitie]) let creche = getCreche(mpData[municipalitie]) let preEscola = getPreEscola(mpData[municipalitie]) var trace1 = { x: years, y: creche, hoverinfo: 'y', type: 'scatter', name: '% Creche', marker: { line: { width: 10 } } }; var trace2 = { x: years, y: preEscola, hoverinfo: 'y', type: 'scatter', name: '% Pré-escola', marker: { line: { width: 10 } } }; var layout = { title: \"&lt;b&gt;Percentuais de matrículas Creches e Pré-escolas do município de \" + municipalitie + \"&lt;b&gt;\", showlegend: true, xaxis: { tickformat: 'Y', hoverformat: 'Y' }, titlefont: { size: 16, family: 'Open Sans, verdana, arial, sans-serif' } }; var data = [trace1, trace2]; Plotly.newPlot('myDiv', data, layout, { locale: 'pt-BR', responsive: true }); /** * @function toImage * @description O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF * do relatório de Matrículas da Educação Infantil. * Será criado um input do tipo hidden * para guardar essa string e posteriormente ser capturada pelo gerador de PDF. * @return {Text} Imagem em base64 */ Plotly.toImage('myDiv', { format: 'jpeg', height: 500, width: 950 }).then(function(response) { response = JSON.stringify(response); $(\"#graficoMatriculas\").remove(); $(\"#myDiv\").append(\"&lt;input type='hidden' id='graficoMatriculas' name='graficoMatriculas' value=\" + response + \"&gt;\"); }); } /** * @function componentMaker * * @description Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no * banco de dados. * * @param {Object} mymap Objeto Leaflet que cria o mapa. */ function componentMaker(mymap) { let years = [] let municipalitie = feature[0].properties.Nome; let filtredMpData = mpData[municipalitie]; $(\"#municipality\").val(municipalitie); let selectVariable = $('#variable'); selectVariable.append($(\"&lt;option/&gt;\").val(filtredMpData[0].Mat_Creche_Per).text(\"Creches\")); selectVariable.append($(\"&lt;option/&gt;\").val(filtredMpData[0].Mat_Pre_Esc_Per).text(\"Pré-escolas\")); let count = 0; for (let i = 0; i &lt; filtredMpData.length; i++) { years.push(filtredMpData[i].Ano) count++ } let min = Math.min.apply(Math, years) let max = Math.max.apply(Math, years) noUiSlider.create(stepSlider, { range: { min: min, max: max }, step: 1, format: { to: function(value) { return value; }, from: function(value) { return value.replace(',-', ''); } }, tooltips: true, start: [min], connect: true, behaviour: 'tap-drag', pips: { mode: 'steps', stepped: true, density: 12, values: count } }); sliderStepDynamics(mymap) poligonMap(mymap) } /** * @function getColorFromMatriculas * * @param {Number} percentual Percentual utilizado para definição das cores das features * @return {text} Cor em hexadecimal ou texto conforme o percentual de creches ou pré-escolas * */ function getColorFromMatriculas(percentual) { let value = $(\"#variable option:selected\").text(); if (value === 'Creches') { //Este trecho irá configuarar as cores e taxas das matrículas Creches if (percentual &gt;= 50) { return \"#29a329\"; } else if (percentual &gt;= 40 &amp;&amp; percentual &lt; 50) { return \"#black\"; } else if (percentual &gt;= 30 &amp;&amp; percentual &lt; 40) { return \"#cca300\"; } else if (percentual &gt;= 20 &amp;&amp; percentual &lt; 30) { return \"#ff8080\"; } else if (percentual &gt;= 10 &amp;&amp; percentual &lt; 20) { return \"#ff1a1a\"; } else if (percentual &lt; 10) { return \"#b30000\"; } } else { if (percentual &gt; 100) { return \"#076d2b\"; } else if (percentual &gt;= 80 &amp;&amp; percentual &lt; 100) { return \"#29a329\"; } else if (percentual &gt;= 60 &amp;&amp; percentual &lt; 80) { return \"black\"; } else if (percentual &gt;= 50 &amp;&amp; percentual &lt; 60) { return \"#cca300\"; } else if (percentual &gt;= 40 &amp;&amp; percentual &lt; 50) { return \"#ff8080\"; } else if (percentual &gt;= 20 &amp;&amp; percentual &lt; 40) { return \"#ff1a1a\"; } else if (percentual &lt; 20) { return \"#b30000\"; } } } /** * @function getValorAbsolutoDeTiposDeMatricula * * @param {Array} aggregateDataByyear Lista de informações do município. * @return {Number} Valores absolutos * */ function getValorAbsolutoDeTiposDeMatricula(aggregateDataByyear) { let value = $(\"#variable option:selected\").text(); if (value == 'Creches') { return aggregateDataByyear.Mat_Creche_Nun; } else { return aggregateDataByyear.Mat_Pre_Esc_Nun; } } function getValueFormatado(value) { numeral.register('locale', 'pt-BR', { delimiters: { thousands: '.', decimal: ',' }, abbreviations: { thousand: 'k', million: 'm', billion: 'b', trillion: 't' }, currency: { symbol: 'R$' } }); return numeral(value); } /** * @function montaTabelaPopUpIdeb * * @description Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. * * @param {array} aggregateDataByyear Lista de informações do município filtradas por ano. * @param {Object} la (layer) camada de exibição do mapa * @return {Text} Html com tabela em html com as informaçãos do município. * */ function montaTabelaPopUpIdeb(aggregateDataByyear, la, year) { let value = $(\"#variable option:selected\").text(); year = parseInt(year); if (aggregateDataByyear == undefined || aggregateDataByyear == -1) { return \"&lt;b class='titleMunicipio'&gt;\" + la.feature.properties.Nome + \"&lt;/b&gt; &lt;p align='center'&gt;Sem Informações&lt;/p&gt;\"; } return \"&lt;table style='font-size: 12px;' class='table table-responsive'&gt; \" + \"&lt;thead&gt;\" + \"&lt;tr&gt;\" + \"&lt;th colspan='2' class='titleMunicipio' align='center' scope='col'&gt;Ano: \" + year + \" - Município: \" + la.feature.properties.Nome + \" &lt;/th&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/thead&gt;\" + \"&lt;tbody&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Pop. Estim. de Crianças IMB - 0 a 3 anos&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + aggregateDataByyear.Pop_0_3 + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Pop. Estim. de Crianças IMB - 4 a 5 anos&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + aggregateDataByyear.Pop_4_5 + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Matrículas em \" + value + \"&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + getValorAbsolutoDeTiposDeMatricula(aggregateDataByyear) + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Taxa de Matrículas em \" + value + \"&lt;/td&gt;\" + \"&lt;td style='font-weight: bold; color:\" + getColorFromMatriculas(aggregateDataByyear[variables[value]]) + \"' align='right'&gt;\" + aggregateDataByyear[variables[value]].toFixed(2) + \"%&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/tbody&gt;\" + \"&lt;/table&gt;\"; } /** * @function poligonMap * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. * * @param {Object} map Objeto Leaflet. * */ function poligonMap(map) { layer.addData(feature); layer.eachLayer(function(la) { let year = stepSlider.noUiSlider.get(); let value = $(\"#variable option:selected\").text() let aggregateDataByyear = getYear(mpData[la.feature.properties.Nome], year); la.bindPopup(montaTabelaPopUpIdeb(aggregateDataByyear, la, year)) setEventMouseOverOnLayer(la, map) }); layer.addTo(map); layer.setStyle(styleMap); } /** * @function setLayer * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, * quando houver troca de ano. * * @param {Object} map Objeto Leaflet. * */ function setLayer(map) { $(\".titleAno\").remove(); $(\".noUi-tooltip\").prepend(\"&lt;div class='titleAno'&gt;Ano: &lt;/div&gt;\"); layer.eachLayer(function(la) { let year = Math.floor(stepSlider.noUiSlider.get()); let value = $(\"#variable option:selected\").text() let aggregateDataByyear = getYear(mpData[la.feature.properties.Nome], year); la.bindPopup(montaTabelaPopUpIdeb(aggregateDataByyear, la, year)) setEventMouseOverOnLayer(la, map) }); layer.setStyle(styleMap) } /** * @function initMap * * @description Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, * neste caso, na div identificada pelo id mapid. * * @param {Object} map Objeto Leaflet. * */ function initMap(feature) { let mymap = L.map('mapid').setView([-16.361508, -49.500561], 6.40); mymap.createPane('labels'); mymap.getPane('labels').style.zIndex = 800 /*650*/ ; L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg', { attribution: 'CAO Educação e UTP Geoprocessamento - CATEP', maxZoom: 18, minZoom: 3, id: 'mapbox.light', accessToken: 'pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg' }).addTo(mymap); $(window).on(\"resize\", function() { $(\"#mapid\").height($(window).height() - 400); mymap.invalidateSize(); }).trigger(\"resize\"); mymap.addControl(new L.Control.Fullscreen()); return mymap; } const stepSlider = document.getElementById('slider-step'); /** * @function promise * * @description O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise * que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, * busca-se os dados de de matrículas da educação infantil em creches e ṕré-escolas e depois será realizado a ordenação deles. * */ const promise = new Promise(function(resolve, reject) { const municipalities = $.get({ url: \"/geojson\", dataType: \"json\", success: function(polygons) {} }); const mpdata = $.get({ url: \"/mpdata\", dataType: \"json\", success: function(mpdata) {} }); $.when(municipalities, mpdata).done(function(polygons, mpdata) { mpData = mpdata[0] feature = polygons[0].features.filter(getFeature); feature.sort(function(a, b) { return (a.properties.Nome &gt; b.properties.Nome) ? 1 : ((b.properties.Nome &gt; a.properties.Nome) ? -1 : 0); }); resolve(); }); }); /** * Após a organização dos dados pelo código acima, será chamado as funções que realizam os procedimentos * de configuração para exbição das informações dos municípios do estado. * */ promise.then(function() { let mymap = initMap(feature); componentMaker(mymap) addLegend(mymap) chartMaker() return mymap }).then(function(mymap) { /** * Este script monitora os eventos de seleção caixa de seleção Percentuais de Matrículas em, caso haja alguma mudança * será montada uma nova camada no mapa com as informações selecionadas. */ let municipalitie = $(\"#municipality\").val(); $(\"#variable\").change(function() { legend.remove(mymap); addLegend(mymap); setLayer(mymap); }); /** * Este script monitora qualquer mudança na barra de anos, caso haja alguma alteração será chamada a função * seta as informação para o ano corresponte. * */ $('#slider-pips').slider({ change: function(event, ui) { setLayer(mymap) } }) /** * Código para capturar o evento de click nas abas da tela e chama o método de criação do gráfico */ $(\".nav-item\").on('click', function() { chartMaker() }) /** * Este script monitora os eventos de seleção e focus do campo Busca por Município, caso seja digitado algum texto * será retornado os municípios de contenham o texo infomado. */ $(\"#municipality\").autocomplete({ source: Object.keys(mpData), select: function(event, ui) { chartMaker() }, focus: function(e, ui) { $(this).val(ui.item.label); return false; } }) /** * Este script monitora os eventos de clique no botão Exibir Município Selecionado, caso haja algum clique nesse botão, * será será exibido o município seleciondo juntamente com suas informações. */ let layerSelected; $(\"#zoomin\").click(function() { let municipalitie = $(\"#municipality\").val(); layer.eachLayer(function(lay) { if (lay.feature.properties.Nome === municipalitie) { layerSelected = lay.setStyle({ color: 'blue', weight: 5, opacity: 2, }); mymap.fitBounds(lay.getBounds()); layerSelected.openPopup() } }); }) /** * Este script monitora os eventos de clique no botão Limpar Seleção, caso haja algum clique nesse botão, * será removida a seleção do município e a visão do mapa sera ampliada. */ $(\"#zoomout\").click(function() { let municipalitie = $(\"#municipality\").val(); mymap.setView([-16.361508, -49.500561], 6.40); layerSelected.setStyle({ color: \"#000000\", weight: 4, opacity: 0.2 }); layerSelected.closePopup() }) /** * Este script monitora os eventos de clique no botão Gerar Relatório PDF, caso haja algum clique nesse botão, * será acionado o programa que gerará o Relatório de Transporte Escolar em PDF. */ $(\"#gerarPdf\").click(function() { let municipalitie = $(\"#municipality\").val(); geraPDF(mpData[municipalitie], municipalitie); }) }); }); × Search results Close "},"client_lib_pdf_geraDocumentoPdfFinanciamento.js.html":{"id":"client_lib_pdf_geraDocumentoPdfFinanciamento.js.html","title":"Source: client/lib/pdf/geraDocumentoPdfFinanciamento.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/pdf/geraDocumentoPdfFinanciamento.js /** * @module client/lib/pdf/geraDocumentoPdfFinanciamento * * @description Relatório do Financimento da Educação em PDF * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ /** * @function dataFormatada * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {Date} data Data do sistema * @param {boolean} horas Se passar true, a função retornará a data com as horas * @return {Date} [data formatada no padrão brasileiro] */ function dataFormatada(d, horas = false) { var data = new Date(d), dia = data.getDate(), mes = data.getMonth() + 1, ano = data.getFullYear(), hora = data.getHours(), minutos = data.getMinutes(), segundos = data.getSeconds(); if (horas === true) { return [dia, mes, ano].join('/') + ' - ' + [hora, minutos, segundos].join(':'); } return [dia, mes, ano].join('/'); } var dataHorarioAtual = dataFormatada(jQuery.now(), true); var data = dataFormatada(jQuery.now()); /** * @function formataDadosParaTabela * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {array} dados Informações do município sobre o Financimento da Educação * @return {array} Lista de dados formatados conforme os requisitos do plugin jsPDF */ function formataDadosParaTabela(dados) { var columns = [ { title: 'Ano', dataKey: \"ano\" }, { title: '* Receitas MDE', dataKey: \"mde\" }, { title: 'Receitas FUNDEB', dataKey: \"fundeb\" }, { title: 'Despesas MDE Educação Infantil', dataKey: \"mde_edu_inf\" }, { title: 'Despesas MDE Educação Fundamental', dataKey: \"mde_edu_fun\" }, { title: 'Despesas FUNDEB Pag. Magistério', dataKey: \"fundeb_pag_mag\" }, { title: 'Despesas FUNDEB Outras Despesas', dataKey: \"fundeb_out_dep\" }, { title: 'Dedução Constitucional', dataKey: \"dedu_const\" }, { title: 'Percentual Certificado', dataKey: \"perc_cert\" } ]; var data = []; /** * Este código ordena os anos do municipio de forma decrescente. */ dados.sort(function(a, b) { return a.ano &lt; b.ano ? -1 : a.ano &gt; b.ano ? 1 : 0; }); $.each(dados, function(index, value) { var item = { ano: value.ano, mde: converterFloatReal(value.item1_mde), fundeb: converterFloatReal(value.item1_fundeb), mde_edu_inf: converterFloatReal(value.itens3e4_mde_edu_inf), mde_edu_fun: converterFloatReal(value.itens3e4_mde_edu_fun), fundeb_pag_mag: converterFloatReal(value.itens3e4_fundeb_pag_mag), fundeb_out_dep: converterFloatReal(value.itens3e4_fundeb_outras_desp), dedu_const: converterFloatReal(value.dedu_const), perc_cert: converterFloatReal(value.item2_perc_cert) + \"%\" }; data.push(item); }); var res = { \"columns\": columns, \"dados\": data }; return res; } /** * @function geraPDF * * @description Esta função gera o PDF transformado os dados da tabela em html para tabela JSON * * @param {array} dados Dados que irão compor a tabela * @param {string} municipio Nome do município * * @returns {PDF} */ function geraPDF(dados, municipio) { /** * * Instância do objeto da classe geradora do PDF * @param {string} orientação:'p'(Portrait) / 'l'(Ladscape) * @param {string} idioma 'pt' * @type jsPDF */ var doc = new jsPDF('l', 'pt'); var totalDePaginas = \"{total_pages_count_string}\"; /** * A função autoTableHtmlToJson transforma uma tabela html em tabela no formato JSON * @returns {JSON} */ var res = formataDadosParaTabela(dados); /** * Esse é o cabeçalho do PDF. * OBS: as imgens que serão usadas no PDF deverão ser convertidas para base64 * @param {type} data * @returns {header} */ var header = function() { doc.setFontType('bold'); doc.text(16, 80, '_________________________________________________________________________________________________________________________'); doc.setFontSize(12); doc.text(45, 110, 'Dados do Financiamento da Educação do Município de ' + municipio); }; /** * Nessa variável consta as informações do rodapé do PDF */ var footer = function() { // console.log(JSON.stringify(dadosDaPagina)); var paginas = \"Página \" + doc.internal.getNumberOfPages(); // Total page number plugin only available in jspdf v1.0+ if (typeof doc.putTotalPages === 'function') { paginas = paginas + \" de \" + totalDePaginas; } var note = '* Impostos e transferências constitucionais'; doc.setFontType('normal'); doc.setFontSize(8); doc.text(note, dadosDaPagina.settings.margin.left + 0, doc.internal.pageSize.height - 70); doc.setFontSize(9); doc.setFontType('normal'); doc.text(paginas, dadosDaPagina.settings.margin.left + 390, doc.internal.pageSize.height - 10); doc.text(dataHorarioAtual, dadosDaPagina.settings.margin.left + 700, doc.internal.pageSize.height - 10); }; doc.setFontSize(8); var options = { margin: { top: 130 }, didDrawPage: function(data) { dadosDaPagina = data; // Header header(); // Footer footer(); }, columnStyles: { ano: { cellWidth: 30 }, mde: { cellWidth: 88 }, fundeb: { cellWidth: 95 }, mde_edu_inf: { cellWidth: 95 }, mde_edu_fun: { cellWidth: 95 }, fundeb_pag_mag: { cellWidth: 95 }, fundeb_out_dep: { cellWidth: 95 }, dedu_const: { cellWidth: 95 }, perc_cert: { cellWidth: 65 } }, //'everyPage' = mostra o cabeçalho a cada página //'firstPage' = mostra o cabeçalho apenas na primeira página //'never' = nunca mostra o cabeçalho showHead: 'everyPage', theme: 'striped', // 'striped', 'grid' or 'plain' startY: false //doc.autoTableEndPosY() + 60 }; doc.autoTable(res.columns, res.dados, options); doc.addImage($(\"#graficoReceitas\").val(), 'JPEG', 200, 220, 400, 310); doc.addPage(); header(); footer(); /** * Este código captura a string da imagem guardada no input hidden na pagina de Financiamento da Educação e adiciona no arquivo do PDF. */ doc.addImage($(\"#graficoDespesas\").val(), 'JPEG', 25, 120, 400, 380); doc.addImage($(\"#graficoOutrasInfo\").val(), 'JPEG', 430, 120, 400, 380); // Este trecho de código verifica a quantidade de páginas do documento. if (typeof doc.putTotalPages === 'function') { doc.putTotalPages(totalDePaginas); } doc.save(\"Financiamento da Educação - \" + municipio + \".pdf\"); } × Search results Close "},"client_lib_pdf_geraDocumentoPdfIdeb.js.html":{"id":"client_lib_pdf_geraDocumentoPdfIdeb.js.html","title":"Source: client/lib/pdf/geraDocumentoPdfIdeb.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/pdf/geraDocumentoPdfIdeb.js /** * @module client/lib/pdf/geraDocumentoPdfIdeb * * @description Relatório do IDEB em PDF. * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ /** * @function dataFormatada * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {d} data Data do sistema * @param {boolean} horas Se passar true, a função retornará a data com as horas * @return {Date} Data formatada no padrão brasileiro] */ function dataFormatada(d, horas = false) { var data = new Date(d), dia = data.getDate(), mes = data.getMonth() + 1, ano = data.getFullYear(), hora = data.getHours(), minutos = data.getMinutes(), segundos = data.getSeconds(); if (horas === true) { return [dia, mes, ano].join('/') + ' - ' + [hora, minutos, segundos].join(':'); } return [dia, mes, ano].join('/'); } var dataHorarioAtual = dataFormatada(jQuery.now(), true); var data = dataFormatada(jQuery.now()); /** * @function formataDadosParaTabela * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {array} dados Informações do município sobre o IDEB * @return {array} Lista de dados formatados conforme os requisitos do plugin jsPDF */ function formataDadosParaTabela(dados) { var columns = [ { title: 'Ano', dataKey: \"ano\" }, { title: 'IDEB', dataKey: \"ideb\" }, { title: 'Meta', dataKey: \"meta\" }, { title: 'Meta atingida?', dataKey: \"atingiu_meta\" } ]; var data = []; dados.sort(function(a, b) { return a.ano &lt; b.ano ? -1 : a.ano &gt; b.ano ? 1 : 0; }); $.each(dados, function(index, value) { var item = { ano: value.ano, ideb: converterFloatReal(value.indice), meta: converterFloatReal(value.meta), atingiu_meta: (value.atingiu_meta == 1 ? \"Sim\" : \"Não\") }; data.push(item); }); var res = { \"columns\": columns, \"dados\": data }; return res; } /** * @function geraPDF * * @description Esta função gera o PDF transformado os dados da tabela em html para tabela JSON * * @param {array} dados Dados que irão compor a tabela * @param {string} municipio Nome do município * @param {string} etapa Etapa escolar * * @returns {PDF} */ function geraPDF(dados, municipio, etapa) { /** * Instância do objeto da classe geradora do PDF * @param {string} orientação:'p'(Portrait) / 'l'(Ladscape) * @param {string} idioma 'pt' * @type jsPDF */ var doc = new jsPDF('p', 'pt'); var totalDePaginas = \"{total_pages_count_string}\"; /** * A função autoTableHtmlToJson transforma uma tabela html em tabela no formato JSON * @returns {JSON} */ var res = formataDadosParaTabela(dados); /** * Esse é o cabeçalho do PDF. * OBS: as imgens que serão usadas no PDF deverão ser convertidas para base64 * @param {type} data * @returns {header} */ var header = function() { doc.setFontType('bold'); doc.text(16, 80, '____________________________________________________________________________________'); doc.setFontSize(13); doc.text(45, 100, 'Dados do IDEB do Município de ' + municipio); doc.text(45, 115, 'Correspondente aos ' + etapa); }; /** * Nessa variável consta as informações do rodapé do PDF * @param {type} data */ var footer = function() { // console.log(JSON.stringify(dadosDaPagina)); var paginas = \"Página \" + doc.internal.getNumberOfPages(); // Total page number plugin only available in jspdf v1.0+ if (typeof doc.putTotalPages === 'function') { paginas = paginas + \" de \" + totalDePaginas; } doc.setFontSize(9); doc.setFontType('normal'); doc.setFontType('normal'); doc.text(paginas, 280, doc.internal.pageSize.height - 10); doc.text(dataHorarioAtual, 495, doc.internal.pageSize.height - 10); }; doc.setFontSize(8); var options = { margin: { top: 150, left: 150, right: 150 }, didDrawPage: function(data) { dadosDaPagina = data; // Header header(); // Footer footer(); }, columnStyles: { ano: { cellWidth: 30 }, ideb: { cellWidth: 30 }, meta: { cellWidth: 30 }, atingiu_meta: { cellWidth: 10 } }, //'everyPage' = mostra o cabeçalho a cada página //'firstPage' = mostra o cabeçalho apenas na primeira página //'never' = nunca mostra o cabeçalho showHead: 'everyPage', theme: 'striped', // 'striped', 'grid' or 'plain' startY: false //doc.autoTableEndPosY() + 60 }; doc.autoTable(res.columns, res.dados, options); doc.addPage(); header(); footer(); /** * Este código captura a string da imagem guardada no input hidden na pagina do IDEB e adiciona no arquivo do PDF. */ doc.addImage($(\"#graficoIdeb\").val(), 'JPEG', 2, 130, 590, 380); // Este trecho de código verifica a quantidade de páginas do documento. if (typeof doc.putTotalPages === 'function') { doc.putTotalPages(totalDePaginas); } doc.save(\"Ideb - \" + municipio + \" - \" + etapa + \".pdf\"); } × Search results Close "},"client_lib_pdf_geraDocumentoPdfMatriculas.js.html":{"id":"client_lib_pdf_geraDocumentoPdfMatriculas.js.html","title":"Source: client/lib/pdf/geraDocumentoPdfMatriculas.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/pdf/geraDocumentoPdfMatriculas.js /** * @module client/lib/pdf/geraDocumentoPdfMatriculas * * @description Relatório Matrículas da Educação Infantil em PDF. * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ /** * @function dataFormatada * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {d} data Data do sistema * @param {boolean} horas Se essa parâmentro receber true, a função retornará a data com as horas * * @return {Date} data Data formatada no padrão brasileiro */ function dataFormatada(d, horas = false) { var data = new Date(d), dia = data.getDate(), mes = data.getMonth() + 1, ano = data.getFullYear(), hora = data.getHours(), minutos = data.getMinutes(), segundos = data.getSeconds(); if (horas === true) { return [dia, mes, ano].join('/') + ' - ' + [hora, minutos, segundos].join(':'); } return [dia, mes, ano].join('/'); } var dataHorarioAtual = dataFormatada(jQuery.now(), true); var data = dataFormatada(jQuery.now()); /** * @function formataDadosParaTabela * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {array} dados Informações do município sobre o Matrículas da Educação Infantil * @return {array} res Lista dados formatado conforme os requisitos do plugin jsPDF */ function formataDadosParaTabela(dados) { var columns = [ { title: 'Ano', dataKey: \"ano\" }, { title: 'Pop. Estim. de Crianças IMB - 0 a 3 anos', dataKey: \"Pop_0_3\" }, { title: 'Pop. Estim. de Crianças IMB - 4 a 5 anos', dataKey: \"Pop_4_5\" }, { title: 'Mat. Creches', dataKey: \"Mat_Creche_Nun\" }, { title: 'Mat. Pré-escolas', dataKey: \"Mat_Pre_Esc_Nun\" }, { title: 'Creches', dataKey: \"Mat_Creche_Per\" }, { title: 'Pré-escolas', dataKey: \"Mat_Pre_Esc_Per\" } ]; var data = []; dados.sort(function(a, b) { return a.ano &lt; b.Ano ? -1 : a.Ano &gt; b.Ano ? 1 : 0; }); $.each(dados, function(index, value) { var item = { ano: value.Ano, Pop_0_3: value.Pop_0_3, Pop_4_5: value.Pop_4_5, Mat_Creche_Nun: value.Mat_Creche_Nun, Mat_Pre_Esc_Nun: value.Mat_Pre_Esc_Nun, Mat_Creche_Per: converterFloatReal(value.Mat_Creche_Per) + '%', Mat_Pre_Esc_Per: converterFloatReal(value.Mat_Pre_Esc_Per) + '%' }; data.push(item); }); var res = { \"columns\": columns, \"dados\": data }; return res; } /** * @function geraPDF * * @description Esta função gera o PDF transformado os dados da tabela em html para tabela JSON * * @param {array} dados Dados que irão compor a tabela * @param {string} municipio Nome do município * * @returns {PDF} */ function geraPDF(dados, municipio) { /** * Instância do objeto da classe geradora do PDF * @param {string} orientação:'p'(Portrait) / 'l'(Ladscape) * @param {string} idioma 'pt' * @type jsPDF */ var doc = new jsPDF('p', 'pt'); var totalDePaginas = \"{total_pages_count_string}\"; /** * A função autoTableHtmlToJson transforma uma tabela html em tabela no formato JSON * @returns {JSON} */ var res = formataDadosParaTabela(dados); /** * Esse é o cabeçalho do PDF. * OBS: as imgens que serão usadas no PDF deverão ser convertidas para base64 * @param {type} data * @returns {header} */ var header = function() { doc.setFontType('bold'); doc.text(16, 80, '____________________________________________________________________________________'); doc.setFontSize(12); doc.text(30, 98, 'Dados de Matrículas da Educação Infantil em Creches e Pré-escolas do Município de '); doc.text(30, 110, municipio); }; /** * Nessa variável consta as informações do rodapé do PDF */ var footer = function() { var paginas = \"Página \" + doc.internal.getNumberOfPages(); // Total page number plugin only available in jspdf v1.0+ if (typeof doc.putTotalPages === 'function') { paginas = paginas + \" de \" + totalDePaginas; } doc.setFontSize(9); doc.setFontType('normal'); doc.setFontType('normal'); doc.text(paginas, 280, doc.internal.pageSize.height - 10); doc.text(dataHorarioAtual, 495, doc.internal.pageSize.height - 10); }; doc.setFontSize(8); var options = { margin: { top: 120, }, didDrawPage: function(data) { dadosDaPagina = data; // Header header(); // Footer footer(); }, columnStyles: { ano: { cellWidth: 30 }, Pop_0_3: { cellWidth: 110 }, Pop_4_5: { cellWidth: 110 }, Mat_Creche_Nun: { cellWidth: 56 }, Mat_Pre_Esc_Nun: { cellWidth: 54 }, Mat_Creche_Per: { cellWidth: 55 }, Mat_Pre_Esc_Per: { cellWidth: 65 } }, //'everyPage' = mostra o cabeçalho a cada página //'firstPage' = mostra o cabeçalho apenas na primeira página //'never' = nunca mostra o cabeçalho showHead: 'everyPage', theme: 'striped', // 'striped', 'grid' or 'plain' startY: false //doc.autoTableEndPosY() + 60 }; doc.autoTable(res.columns, res.dados, options); doc.addPage(); header(); footer(); /** * Este código captura a string da imagem guardada no input hidden na pagina de Matrículas da Educação Infantil e adiciona no arquivo do PDF. */ doc.addImage($(\"#graficoMatriculas\").val(), 'JPEG', 2, 130, 590, 380); // Este trecho de código verifica a quantidade de páginas do documento. if (typeof doc.putTotalPages === 'function') { doc.putTotalPages(totalDePaginas); } doc.save(\"Matrículas - \" + municipio + \".pdf\"); } × Search results Close "},"client_lib_pdf_geraDocumentoPdfTransporte.js.html":{"id":"client_lib_pdf_geraDocumentoPdfTransporte.js.html","title":"Source: client/lib/pdf/geraDocumentoPdfTransporte.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/pdf/geraDocumentoPdfTransporte.js /** * @module client/lib/pdf/geraDocumentoPdfTransporte * * @description Relatório do Transporte Escolar em PDF * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ /** * @function dataFormatada * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {d} data Data do sistema * @param {boolean} horas Se essa parâmentro receber true, a função retornará a data com as horas * * @return {Date} data Data formatada no padrão brasileiro */ function dataFormatada(d, horas = false) { var data = new Date(d), dia = data.getDate(), mes = data.getMonth() + 1, ano = data.getFullYear(), hora = data.getHours(), minutos = data.getMinutes(), segundos = data.getSeconds(); if (horas === true) { return [dia, mes, ano].join('/') + ' - ' + [hora, minutos, segundos].join(':'); } return [dia, mes, ano].join('/'); } var dataHorarioAtual = dataFormatada(jQuery.now(), true); var data = dataFormatada(jQuery.now()); /** * @function getTextoPP * * @param {string} pp Participação da promotoria * @return {string} texto */ function getTextoPP(pp) { var texto; if (pp == 'N') { texto = \"Não participou\"; } else if (pp == 'S') { texto = \"Participou\"; } else if (pp == 'NA') { texto = \" Município não informou\"; } return texto; } /** * @function getPercentuaFormatado * * @param {value} percentual * * @return {number} percentual formatado */ function getPercentuaFormatado(value) { return $.number(value, 2); } /** * @function formataDadosParaTabela * * @description Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. * * @param {array} dados Informações do município sobre o Transporte Escolar * @return {array} res Lista de dados formatados conforme os requisitos do plugin jsPDF */ function formataDadosParaTabela(dados) { var columns = [ { title: 'Ano', dataKey: \"ano\" }, { title: 'Participação da Promotoria', dataKey: \"pp\" }, { title: 'Aprovado', dataKey: \"aprov\" }, { title: 'Reprovado', dataKey: \"reprov\" }, { title: 'Não Vistoriados', dataKey: \"nao_comp\" }, { title: 'Total', dataKey: \"total\" }, { title: 'Taxa de Veículos Aprovados', dataKey: \"p_aprov\" }, { title: 'Taxa de Veículos Reprovados', dataKey: \"p_reprov\" }, { title: 'Taxa de Veículos Não Vistoriados', dataKey: \"p_naocomp\" } ]; var data = []; dados.sort(function(a, b) { return a.ano &lt; b.ano ? -1 : a.ano &gt; b.ano ? 1 : 0; }); $.each(dados, function(index, value) { var item = { ano: value.ano, pp: getTextoPP(value.pp), aprov: value.aprov, reprov: value.reprov, nao_comp: value.nao_comp, total: value.total, p_aprov: (value.p_aprov &lt; 0 ? '-' : getPercentuaFormatado(value.p_aprov) + '%'), p_reprov: (value.p_aprov &lt; 0 ? '-' : getPercentuaFormatado(value.p_reprov) + '%'), p_naocomp: (value.p_aprov &lt; 0 ? '-' : getPercentuaFormatado(value.p_naocomp) + '%') }; data.push(item); }); var res = { \"columns\": columns, \"dados\": data }; return res; } /** * @function geraPDF * * @description Esta função gera o PDF transformado os dados da tabela em html para tabela JSON * * @param {array} dados { dados que irão compor a tabela } * @param {string} municipio { nome do município } * * @returns {PDF} */ function geraPDF(dados, municipio, semestre) { /** * Instância do objeto da classe geradora do PDF * @param {string} orientação:'p'(Portrait) / 'l'(Ladscape) * @param {string} idioma 'pt' * @type jsPDF */ var doc = new jsPDF('l', 'pt'); var totalDePaginas = \"{total_pages_count_string}\"; /** * A função autoTableHtmlToJson transforma uma tabela html em tabela no formato JSON * @returns {JSON} */ var res = formataDadosParaTabela(dados); /** * Esse é o cabeçalho do PDF. * OBS: as imgens que serão usadas no PDF deverão ser convertidas para base64 * @param {type} data * @returns {header} */ var header = function() { doc.setFontType('bold'); doc.text(16, 80, '_________________________________________________________________________________________________________________________'); doc.setFontSize(12); doc.text(45, 110, 'Dados do Transporte Escolar do Município de ' + municipio); doc.text(45, 125, 'do ' + semestre + ' Semestre'); }; /** * Nessa variável consta as informações do rodapé do PDF * @param {type} data */ var footer = function() { var paginas = \"Página \" + doc.internal.getNumberOfPages(); // Total page number plugin only available in jspdf v1.0+ if (typeof doc.putTotalPages === 'function') { paginas = paginas + \" de \" + totalDePaginas; } doc.setFontSize(9); doc.setFontType('normal'); doc.text(paginas, dadosDaPagina.settings.margin.left + 390, doc.internal.pageSize.height - 10); doc.text(dataHorarioAtual, dadosDaPagina.settings.margin.left + 700, doc.internal.pageSize.height - 10); }; doc.setFontSize(8); var options = { margin: { top: 140 }, didDrawPage: function(data) { dadosDaPagina = data; // Header header(); // Footer footer(); }, columnStyles: { ano: { cellWidth: 30 }, pp: { cellWidth: 80 }, aprov: { cellWidth: 80 }, reprov: { cellWidth: 80 }, total: { cellWidth: 50 }, p_aprov: { cellWidth: 80 }, p_reprov: { cellWidth: 80 }, p_naocomp: { cellWidth: 80 } }, //'everyPage' = mostra o cabeçalho a cada página //'firstPage' = mostra o cabeçalho apenas na primeira página //'never' = nunca mostra o cabeçalho showHead: 'everyPage', theme: 'striped', // 'striped', 'grid' or 'plain' startY: false //doc.autoTableEndPosY() + 60 }; doc.autoTable(res.columns, res.dados, options); doc.addPage(); header(); footer(); /** * Este código captura a string da imagem guardada no input hidden na pagina de Transporte Escolar e adiciona no arquivo do PDF. */ doc.addImage($(\"#graficoTransporte\").val(), 'JPEG', 8, 130, 780, 400); // Este trecho de código verifica a quantidade de páginas do documento. if (typeof doc.putTotalPages === 'function') { doc.putTotalPages(totalDePaginas); } doc.save(\"Transporte Escolar - \" + municipio + \" - \" + semestre + \" Semestre.pdf\"); } × Search results Close "},"client_lib_transporte.js.html":{"id":"client_lib_transporte.js.html","title":"Source: client/lib/transporte.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/transporte.js /** * @module client/lib/transporte * * @description Transporte Escolar * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ $(document).ready(function() { Plotly.setPlotConfig({ locale: 'pt-BR' }) // Setando configuração de localidade para o Plugin Plotly (Gerador de gráficos). let feature; let dadosTransporte; let layer = L.geoJson(); let legend; const variables = { 'p_aprov': 'p_aprov' } /** * @function getFeature * * @description Esta função é reponsável por capturar o objeto referente a área do município (feature) * do objeto geoJSON. * * @param {Object} feature Área do município * @return {Object} Área do município. * */ function getFeature(feature) { return feature } /** * @function addLegend * * @description Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. * * @param {Object} map Objeto Leaflet * */ function addLegend(map) { legend = L.control({ position: 'bottomright' }); legend.onAdd = function(map) { var div = L.DomUtil.create('div', 'info legend'), grades = [0, 10, 20, 50, 100, 200, 500, 1000], labels = []; div.innerHTML = '&lt;span style=\"font-weight: 600;\"&gt;LEGENDA&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#0033cc\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;Não informou&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#b30000\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;00,00% - 22,00%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ff8c1a\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;22,00% - 53,00%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#ffff00\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;53,00% - 76,00%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#29a329\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;76,00% - 92,00%&lt;/span&gt;&lt;br&gt;' + '&lt;i style=\"background:#076d2b\";&gt;&lt;/i&gt;&lt;span style=\"font-weight: 500;\"&gt;92,00% - 100,00%&lt;/span&gt;&lt;br&gt;'; return div; }; legend.addTo(map); } /** * @function sliderStepDynamics * * @description Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Matrículas da Educação Infantil * Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente * ao ano selecionado. * * @param {Object} map Objeto Leaflet * */ function sliderStepDynamics(map) { stepSlider.noUiSlider.on('update', function(values, handle) { setLayer(map) }); } /** * @function getYear * * @description Esta função é reponsável por filtrar as informações do município pelo ano e semestre selecionado. * * @param {Array} list Lista com os municípios do estado * @param {Number} year Ano selecionado * * @return {Array} Lista de informações do município filtradas por ano e semestre. * */ function getYear(list, year) { var semestre = $(\"#semestre option:selected\").val(); year = parseInt(year); var munSemValores = 0; var qtdeMun; if (list === undefined) { munSemValores++; return -1 } var muns = []; for (let i = 0; i &lt; list.length; i++) { if (year === undefined) { return -1; } else { if (list[i].ano == year &amp;&amp; semestre == list[i].semestre) { return list[i]; } } } } /** * @function getStylePercentualAprovado * * @description Esta função é reponsável por definir a cor da área (polígono) do município no * mapa conforme o percentual aprovado. * * @param {Array} aggregateDataByyear Lista de informações do município filtradas por ano. * * @return {Object} Objeto com parâmetros para estilização das áres dos municípios. * */ function getStylePercentualAprovado(aggregateDataByyear) { let value = aggregateDataByyear[variables['p_aprov']]; // value = $.number( value, 2 ); //Este trecho irá configuarar as cores e taxas de percetuais de aprovação if (value == -1) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#0033cc\" }; } else if (value &gt;= 92.00 &amp;&amp; value &lt;= 100.0) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#076d2b\" }; } else if (value &gt;= 76.00 &amp;&amp; value &lt; 92.00) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#29a329\" }; } else if (value &gt;= 53.00 &amp;&amp; value &lt; 76.00) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#ffff00\" }; } else if (value &gt;= 22.00 &amp;&amp; value &lt; 53.00) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#ff8c1a\" }; } else if (value &lt; 22.00) { return { color: \"#000000\", opacity: 0.4, weight: 2, fillOpacity: 1.9, fillColor: \"#b30000\" }; } } /** * @function styleMap * * @description Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. * * @param {object} feat Feature do município. * * @return {object} Objeto com informações do estilo do município. * */ function styleMap(feat) { let year = stepSlider.noUiSlider.get(); let aggregateDataByyear = getYear(dadosTransporte[feat.properties.Nome], year); if (aggregateDataByyear == undefined) { return { color: \"#0000FF\", opacity: 0.2, weight: 2, fillOpacity: 1.9, fillColor: \"#0033cc\" }; } if (dadosTransporte[feat.properties.Nome] !== undefined) { return getStylePercentualAprovado(aggregateDataByyear); } } /** * @function getYearsFromMun * * @description Esta função responsável por filtrar da lista de informações classificadas por ano, * os anos de um determinado município. * * @param {Array} list Lista de informações do município. * * @return {Array} Lista anos do município. * */ function getYearFromMun(list) { var semestre = $(\"#semestre option:selected\").val(); let years = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].semestre == semestre) { years.push(list[i].ano) } } return years } /** * @function getPercentualAprovado * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente ao percentual aprovado (p_aprov). * * @param {Array} list Lista de informações do município. * * @return {Number} Percentual aprovado. * */ function getPercentualAprovado(list) { var semestre = $(\"#semestre option:selected\").val(); let perAprovado = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].semestre == semestre) { perAprovado.push(list[i].p_aprov) } } return perAprovado } /** * @function getPercentualReprovado * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente ao percentual reprovado (p_reprov). * * @param {Array} list Lista de informações do município. * * @return {Number} Percentual reprovado. * */ function getPercentualReprovado(list) { var semestre = $(\"#semestre option:selected\").val(); let perReprovado = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].semestre == semestre) { perReprovado.push(list[i].p_reprov) } } return perReprovado } /** * @function getPercentualNaoCompareceu * * @description Esta função responsável por filtrar da lista de informações do município, * o valor correspondente ao percentual de veículos que não compareceram a vistoria (p_naocomp). * * @param {Array} list Lista de informações do município. * * @return {Number} Percentual de veículos que não compareceram a vistoria. * */ function getPercentualNaoCompareceu(list) { var semestre = $(\"#semestre option:selected\").val(); let perNaoComp = []; for (let i = 0; i &lt; list.length; i++) { if (list[i].semestre == semestre) { perNaoComp.push(list[i].p_naocomp) } } return perNaoComp } /** * @function chartMaker * * @description Esta função é responsável por gerar o gráfico de Vistoria do transporte escolar dos municípios * */ function chartMaker() { let municipalitie = $(\"#municipality\").val(); let years = getYearFromMun(dadosTransporte[municipalitie]) let perAprovado = getPercentualAprovado(dadosTransporte[municipalitie]) let perReprovado = getPercentualReprovado(dadosTransporte[municipalitie]) let perNaoComp = getPercentualNaoCompareceu(dadosTransporte[municipalitie]) var trace1 = { x: years, y: perAprovado, hoverinfo: 'y', type: 'scatter', name: '% Aprovados', marker: { line: { width: 10 } } }; var trace2 = { x: years, y: perReprovado, hoverinfo: 'y', type: 'scatter', name: '% Reprovados', marker: { line: { width: 10 } } }; var trace3 = { x: years, y: perNaoComp, hoverinfo: 'y', type: 'scatter', hoverinfo: 'y', name: '% Não Compareceu', marker: { line: { width: 10 } } }; var layout = { title: \"&lt;b&gt; Vistoria do transporte escolar do município de \" + municipalitie + \" &lt;b&gt;\", showlegend: true, xaxis: { title: \"\", nticks: 3, tickformat: 'Y', hoverformat: 'Y' }, titlefont: { size: 16, family: 'Open Sans, verdana, arial, sans-serif' } }; var data = [trace1, trace2, trace3]; Plotly.newPlot('myDiv', data, layout, { locale: 'pt-BR', responsive: true }); /** * @function toImage * @description O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF * do relatório do Transporte Escolar. * Será criado um input do tipo hidden * para guardar essa string e posteriormente ser capturada pelo gerador de PDF. * @return {Text} Imagem em base64 */ Plotly.toImage('myDiv', { format: 'jpeg', height: 450, width: 1000 }).then(function(response) { response = JSON.stringify(response); $(\"#graficoTransporte\").remove(); $(\"#myDiv\").append(\"&lt;input type='hidden' id='graficoTransporte' name='graficoTransporte' value=\" + response + \"&gt;\"); }); } /** * @function componentMaker * * @description Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no * banco de dados. * */ function componentMaker(mymap) { let years = [] let municipalitie = feature[0].properties.Nome; let filterdadosTransporte = dadosTransporte[municipalitie]; $(\"#municipality\").val(municipalitie); let count = 0; for (let i = 0; i &lt; filterdadosTransporte.length; i++) { years.push(filterdadosTransporte[i].ano) count++ } let min = Math.min.apply(Math, years) let max = Math.max.apply(Math, years) noUiSlider.create(stepSlider, { range: { min: min, max: max }, format: { to: function(value) { return value; }, from: function(value) { return value.replace(',-', ''); } }, tooltips: true, step: 1, start: [min], connect: true, behaviour: 'tap-drag', pips: { mode: 'steps', stepped: true, density: 12, values: count } }); sliderStepDynamics(mymap) poligonMap(mymap) } /** * @function getColorFromPercentualAprovado * * @param {Number} percentual Percentual Aprovado * @return {Text} Cor conforme o percentual aprovado * */ function getColorFromPercentualAprovado(percentual) { var value = $.number(percentual, 2); if (value == -1) { return \"#0033cc\"; } else if (value &gt;= 92.00 &amp;&amp; value &lt;= 100.0) { return \"#076d2b\"; } else if (value &gt;= 76.00 &amp;&amp; value &lt; 92.00) { return \"#29a329\"; } else if (value &gt;= 53.00 &amp;&amp; value &lt; 76.00) { return \"black\"; } else if (value &gt;= 22.00 &amp;&amp; value &lt; 53.00) { return \"#ff8c1a\"; } else if (value &lt; 22.00) { return \"#b30000\"; } } /** * @function montaTabelaPopUpIdeb * * @description Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. * * @param {Array} aggregateDataByyear Lista de informações do município filtradas por ano. * @param {Object} la Camada(layer) de exibição do mapa * @return {Text} Tabela em html com as informaçãos do município. * */ function montaTabelaPopUpIdeb(aggregateDataByyear, la) { if (aggregateDataByyear == undefined || aggregateDataByyear == -1) { return \"&lt;b class='titleMunicipio'&gt;\" + la.feature.properties.Nome + \"&lt;/b&gt; &lt;p align='center'&gt;Sem informações&lt;/p&gt;\"; } else if (aggregateDataByyear.p_aprov == -1) { return \"&lt;b class='titleMunicipio'&gt;\" + la.feature.properties.Nome + \"&lt;/b&gt; &lt;p align='center'&gt;O município não informou dados&lt;/p&gt;\"; } return \"&lt;table style='font-size: 12px;' class='table table-responsive'&gt; \" + \"&lt;thead&gt;\" + \"&lt;tr&gt;\" + \"&lt;th colspan='2' class='titleMunicipio' align='center' scope='col'&gt;Ano: \" + aggregateDataByyear.ano + \" - Município: \" + la.feature.properties.Nome + \" &lt;/th&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/thead&gt;\" + \"&lt;tbody&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Veículos Aprovados&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + aggregateDataByyear.aprov + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Veículos Reprovados&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + aggregateDataByyear.reprov + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Veículos não vistoriados&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + aggregateDataByyear.nao_comp + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Total de Veículos&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + aggregateDataByyear.total + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Percentual de Veículos Aprovados&lt;/td&gt;\" + \"&lt;td style='font-weight: bold; color:\" + getColorFromPercentualAprovado(aggregateDataByyear.p_aprov) + \"' align='right'&gt;\" + getPercentuaFormatado(aggregateDataByyear.p_aprov) + \"%&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Percentual de Veículos Reprovados&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + getPercentuaFormatado(aggregateDataByyear.p_reprov) + \"%&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Percentual de Veículos Não vistoriados&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + getPercentuaFormatado(aggregateDataByyear.p_naocomp) + \"%&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;td&gt;Participação da Promotoria&lt;/td&gt;\" + \"&lt;td align='right'&gt;\" + getTextoPP(aggregateDataByyear.pp) + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/tbody&gt;\" + \"&lt;/table&gt;\"; } /** * @function poligonMap * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. * * @param {Object} map Objeto Leaflet. * */ function poligonMap(map) { layer.addData(feature); layer.eachLayer(function(la) { let year = stepSlider.noUiSlider.get(); let aggregateDataByyear = getYear(dadosTransporte[la.feature.properties.Nome], year); la.bindPopup(montaTabelaPopUpIdeb(aggregateDataByyear, la)) setEventMouseOverOnLayer(la, map) }); layer.addTo(map); layer.setStyle(styleMap); } /** * @function setLayer * * @description Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, * quando houver troca de ano. * * @param {Object} map Objeto Leaflet. * */ function setLayer(map) { $(\".titleAno\").remove(); $(\".noUi-tooltip\").prepend(\"&lt;div class='titleAno'&gt;Ano: &lt;/div&gt;\"); layer.eachLayer(function(la) { let year = Math.floor(stepSlider.noUiSlider.get()); let aggregateDataByyear = getYear(dadosTransporte[la.feature.properties.Nome], year); la.bindPopup(montaTabelaPopUpIdeb(aggregateDataByyear, la)) setEventMouseOverOnLayer(la, map) }); layer.setStyle(styleMap) } /** * @function initMap * * @description Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, * neste caso, na div identificada pelo id mapid. * * @param {Object} map Objeto Leaflet. * */ function initMap(feature) { let mymap = L.map('mapid').setView([-16.361508, -49.500561], 6.40); mymap.createPane('labels'); mymap.getPane('labels').style.zIndex = 800 /*650*/ ; L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg', { attribution: 'CAO Educação e UTP Geoprocessamento - CATEP', maxZoom: 18, minZoom: 3, id: 'mapbox.light', accessToken: 'pk.eyJ1Ijoiam9zZXVtYmVydG9tb3JlaXJhIiwiYSI6ImNqbDJuMDkyYjFzZnMzcnF4NHhtcXZjc2MifQ.t7kEbLAbmqBoewQvM5HgDg' }).addTo(mymap); $(window).on(\"resize\", function() { $(\"#mapid\").height($(window).height() - 400); mymap.invalidateSize(); }).trigger(\"resize\"); mymap.addControl(new L.Control.Fullscreen()); return mymap; } const stepSlider = document.getElementById('slider-step'); /** * @function promise * * @description O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise * que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, * busca-se os dados do Transporte Escolar e depois será realizado a ordenação deles. * */ const promise = new Promise(function(resolve, reject) { const municipalities = $.get({ url: \"/geojson\", dataType: \"json\", success: function(polygons) {} }); const dadostransporte = $.get({ url: \"/transporte\", dataType: \"json\", success: function(dadostransporte) {} }); $.when(municipalities, dadostransporte).done(function(polygons, dadostransporte) { dadosTransporte = dadostransporte[0] feature = polygons[0].features.filter(getFeature); feature.sort(function(a, b) { return (a.properties.Nome &gt; b.properties.Nome) ? 1 : ((b.properties.Nome &gt; a.properties.Nome) ? -1 : 0); }); resolve(); }); }); /** * Após a organização dos dados pelo código acima, será chamado as funções que realizam os procedimentos * de configuração para exbição das informações dos municípios do estado. * */ promise.then(function() { let mymap = initMap(feature); componentMaker(mymap) addLegend(mymap) chartMaker() return mymap }).then(function(mymap) { /** * Este script monitora os eventos de seleção caixa de seleção Semestre, caso haja alguma mudança * será montada uma nova camada no mapa com as informações selecionadas. */ let municipalitie = $(\"#municipality\").val(); $(\"#semestre\").change(function() { legend.remove(mymap); addLegend(mymap); setLayer(mymap); chartMaker(); }); /** * Este script monitora qualquer mudança na barra de anos, caso haja alguma alteração será chamada a função * seta as informação para o ano corresponte. * */ $('#slider-pips').slider({ change: function(event, ui) { setLayer(mymap) } }) /** * Código para capturar o evento de click nas abas da tela e chama o método de criação do gráfico */ $(\".nav-item\").on('click', function() { chartMaker() }) /** * Este script monitora os eventos de seleção e focus do campo Busca por Município, caso seja digitado algum texto * será retornado os municípios de contenham o texo infomado. */ $(\"#municipality\").autocomplete({ source: Object.keys(dadosTransporte), select: function(event, ui) { chartMaker() }, focus: function(e, ui) { $(this).val(ui.item.label); return false; } }) /** * Este script monitora os eventos de clique no botão Exibir Município Selecionado, caso haja algum clique nesse botão, * será será exibido o município seleciondo juntamente com suas informações. */ let layerSelected; $(\"#zoomin\").click(function() { let municipalitie = $(\"#municipality\").val(); layer.eachLayer(function(lay) { if (lay.feature.properties.Nome === municipalitie) { layerSelected = lay.setStyle({ color: 'blue', weight: 5, opacity: 2, }); mymap.fitBounds(lay.getBounds()); layerSelected.openPopup() } }); }) /** * Este script monitora os eventos de clique no botão Limpar Seleção, caso haja algum clique nesse botão, * será removida a seleção do município e a visão do mapa sera ampliada. */ $(\"#zoomout\").click(function() { let municipalitie = $(\"#municipality\").val(); mymap.setView([-16.361508, -49.500561], 6.40); layerSelected.setStyle({ color: \"#000000\", weight: 4, opacity: 0.2 }); layerSelected.closePopup() }) /** * @function getMunicipioPorSemestre * * @description Esta função responsável por filtar municipios por semestre * * @param {Object} mun Municipio * * @return {Boolean} (true / false) * */ function getMunicipioPorSemestre(mun) { var semestre = $(\"#semestre option:selected\").val(); return mun.semestre == semestre; } $(\"#gerarPdf\").click(function() { let municipalitie = $(\"#municipality\").val(); var semestre = $(\"#semestre option:selected\").text(); geraPDF(dadosTransporte[municipalitie].filter(getMunicipioPorSemestre), municipalitie, semestre); }) }); }); × Search results Close "},"client_lib_util.js.html":{"id":"client_lib_util.js.html","title":"Source: client/lib/util.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: client/lib/util.js /** * @module client/lib/util * * @description Funções globais * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Tharles de Sousa Andrade * @license MIT */ /** * @function converterFloatReal * * @param {number} valor Valor no formato americano * @return {number} valor valor no formato brasileiro */ function converterFloatReal(valor) { var inteiro = null, decimal = null, c = null, j = null; var aux = new Array(); valor = \"\" + valor; c = valor.indexOf(\".\", 0); //encontrou o ponto na string if (c &gt; 0) { //separa as partes em inteiro e decimal inteiro = valor.substring(0, c); decimal = valor.substring(c + 1, valor.length); } else { inteiro = valor; } //pega a parte inteiro de 3 em 3 partes for (j = inteiro.length, c = 0; j &gt; 0; j -= 3, c++) { aux[c] = inteiro.substring(j - 3, j); } //percorre a string acrescentando os pontos inteiro = \"\"; for (c = aux.length - 1; c &gt;= 0; c--) { inteiro += aux[c] + '.'; } inteiro = inteiro.replace(\"-.\", \"-\"); //retirando o ultimo ponto e finalizando a parte inteiro inteiro = inteiro.substring(0, inteiro.length - 1); decimal = parseInt(decimal); if (isNaN(decimal)) { decimal = \"00\"; } else { decimal = \"\" + decimal; if (decimal.length === 1) { decimal = \"0\" + decimal; } } valor = inteiro + \",\" + decimal; return valor; } /** * @function setEventMouseOverOnLayer * * @description Função responsável por habilitar o evento que monitora * quando o cursor do mouse paira sobre algum município, * acionando o PopUp com as informações do município que está sobre. * * @param {object} layer Camada de exibição do mapa * @param {object} map objeto do mapa */ function setEventMouseOverOnLayer(layer, map) { /** * Função responsável por habilitar a exibição dos dados do município ao passar o mouse sobre a área dele. */ layer.on('mouseover', function(e) { e.target.closePopup(); var popup = e.target.getPopup(); popup.setLatLng(e.latlng).openOn(map); }); layer.on('mouseout', function(e) { e.target.closePopup(); }); layer.on('mousemove', function(e) { e.target.closePopup(); var popup = e.target.getPopup(); popup.setLatLng(e.latlng).openOn(map); }); } × Search results Close "},"server_main.js.html":{"id":"server_main.js.html","title":"Source: server/main.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/main.js /** * @module server/main * * @description Servidor da Aplicação, responsável por iniciar os serviços que serão requisitado pelos clientes. * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT */ /** * Declaração das dependências utilizadas no servidor * */ var express = require('express'); var consign = require('consign'); var chain = require('middleware-chain'); var bodyParser = require('body-parser'); var ip = require('ip'); var app = express(); var fs = require('fs'); var erros = require('./utils/erros.js'); var path = require('path'); /** * Configurações para debug do programa * */ const debug = require('debug')('my-namespace'); const name = 'App CAO Educacao'; debug('booting %s', name); /** * Disponibilização de rotas para os módulos da aplicação. * */ app.use(express.static(__dirname + './../client/')); app.use(bodyParser.json({limit: '50mb'})) app.use(bodyParser.urlencoded({limit: '50mb', extended: true })) app.use('/principal',express.static(__dirname + './../client/')); app.use('/erros', express.static(__dirname + './../client/pages/erros/404.html')); consign() .include('middleware') .then('routers') .into(app); chain([ app.middleware.repository.municipios, app.middleware.repository.db, app.middleware.repository.dadosTransporte, app.middleware.repository.dadosFinanciamento, app.middleware.repository.dadosIdeb, app.middleware.repository.mun, app.routers.geojson.geojson ]); /** * Definição da porta em que a aplicação irá ser executada. * */ app.listen(3000, function(){ console.log(\"Servidor da Plataforma do CAO Educação disponível no endereço: http://\"+ip.address()) }); × Search results Close "},"server_middleware_parsedb.js.html":{"id":"server_middleware_parsedb.js.html","title":"Source: server/middleware/parsedb.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/middleware/parsedb.js /** * @module server/middleware/parsedb * * @description Script encarregado de agrupar todas as informações oriundas da tabela de Matrículas da Educação * Infantil de um determinado município em um objeto. * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT */ module.exports = { parse: function(dbobject) { let cities = {}; for(let i = 0; i &lt; dbobject.length; i++){ cities[dbobject[i].Municipio] = []; } for(let i = 0; i &lt; dbobject.length; i++){ if( cities[dbobject[i].Municipio] ){ cities[dbobject[i].Municipio].push({ Cod_Munic: dbobject[i].Cod_Munic, Ano: dbobject[i].Ano, Pop_0_3: dbobject[i].Pop_0_3, Pop_4_5: dbobject[i].Pop_4_5, Mat_Creche_Nun: dbobject[i].Mat_Creche_Nun, Mat_Creche_Per: dbobject[i].Mat_Creche_Per, Mat_Pre_Esc_Nun: dbobject[i].Mat_Pre_Esc_Nun, Mat_Pre_Esc_Per: dbobject[i].Mat_Pre_Esc_Per }) } } return cities; } }; × Search results Close "},"server_middleware_parseFinanciamento.js.html":{"id":"server_middleware_parseFinanciamento.js.html","title":"Source: server/middleware/parseFinanciamento.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/middleware/parseFinanciamento.js /** * @module server/middleware/parseFinanciamento * * @description Script encarregado de agrupar todas as informações oriundas da tabela de Fiananciemento da Educação de um determinado município em um objeto. * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT */ module.exports = { parse: function(dbobject) { let dadosFinanciamento = {}; // console.log(JSON.stringify(dbobject, null, 2)); for(let i = 0; i &lt; dbobject.length; i++){ dadosFinanciamento[dbobject[i].Municipio] = []; } for(let i = 0; i &lt; dbobject.length; i++){ if( dadosFinanciamento[dbobject[i].Municipio] ){ dadosFinanciamento[dbobject[i].Municipio].push({ id_financiamento: dbobject[i].id_financiamento, ano: dbobject[i].ano, item1_mde: dbobject[i].item1_mde, item1_fundeb: dbobject[i].item1_fundeb, itens3e4_mde_edu_inf: dbobject[i].itens3e4_mde_edu_inf, itens3e4_mde_edu_fun: dbobject[i].itens3e4_mde_edu_fun, itens3e4_fundeb_pag_mag: dbobject[i].itens3e4_fundeb_pag_mag, itens3e4_fundeb_outras_desp: dbobject[i].itens3e4_fundeb_outras_desp, dedu_const: dbobject[i].dedu_const, item2_perc_cert: dbobject[i].item2_perc_cert, cod_municipio: dbobject[i].cod_municipio }) } } return dadosFinanciamento; } }; × Search results Close "},"server_middleware_parseIdeb.js.html":{"id":"server_middleware_parseIdeb.js.html","title":"Source: server/middleware/parseIdeb.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/middleware/parseIdeb.js /** * @module server/middleware/parseIdeb * * @description Script encarregado de agrupar todas as informações oriundas da tabela de IDEB de um determinado município em um objeto. * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT */ module.exports = { parse: function(dbobject) { let dadosIdeb = {}; for(let i = 0; i &lt; dbobject.length; i++){ dadosIdeb[dbobject[i].Municipio] = []; } for(let i = 0; i &lt; dbobject.length; i++){ if( dadosIdeb[dbobject[i].Municipio] ){ dadosIdeb[dbobject[i].Municipio].push({ id_ideb: dbobject[i].id_ideb, ano: dbobject[i].ano, classe: dbobject[i].classe, indice: dbobject[i].indice, meta: dbobject[i].meta, atingiu_meta: dbobject[i].atingiu_meta, cod_municipio: dbobject[i].cod_municipio }) } } return dadosIdeb; } }; × Search results Close "},"server_middleware_parseTransporte.js.html":{"id":"server_middleware_parseTransporte.js.html","title":"Source: server/middleware/parseTransporte.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/middleware/parseTransporte.js /** * @module server/middleware/parseTransporte * * @description Script encarregado de agrupar todas as informações oriundas da tabela de Transporte Escolar * de um determinado município em um objeto. * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT */ module.exports = { parse: function(dbobject) { let dadosTransporte = {}; for(let i = 0; i &lt; dbobject.length; i++){ dadosTransporte[dbobject[i].Municipio] = []; } for(let i = 0; i &lt; dbobject.length; i++){ if( dadosTransporte[dbobject[i].Municipio] ){ dadosTransporte[dbobject[i].Municipio].push({ id_transporte: dbobject[i].id_transporte, ano: dbobject[i].ano, semestre: dbobject[i].semestre, pp: dbobject[i].pp, aprov: dbobject[i].aprov, reprov: dbobject[i].reprov, nao_comp: dbobject[i].nao_comp, total: dbobject[i].total, p_aprov: dbobject[i].p_aprov, p_reprov: dbobject[i].p_reprov, p_naocomp: dbobject[i].p_naocomp, cod_municipio: dbobject[i].cod_municipio }) } } return dadosTransporte; } }; × Search results Close "},"server_middleware_repository.js.html":{"id":"server_middleware_repository.js.html","title":"Source: server/middleware/repository.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/middleware/repository.js /** * @module server/middleware/repository * * @description Módulo de acesso ao Banco de dados e busca das informações das informações * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT */ const mysql = require('mysql'); const fs = require('fs'); const asyncLoop = require('node-async-loop'); const parsedb = require('./parsedb.js'); const parseTransporte = require('./parseTransporte.js'); const parseFinanciamento = require('./parseFinanciamento.js'); const parseIdeb = require('./parseIdeb.js'); const db_config = { host : '127.0.0.1', user : 'caoedu', password : 'caoeducatep', database : 'CaoEdu' } let connection; /** * @function handleDisconnect * * @description Função encarregada de realizar a conexão com o banco de dados. */ function handleDisconnect() { connection = mysql.createConnection(db_config); connection.connect(function(err) { if(err) { console.log('Erro ao tentar conectar com MySQL:', err); setTimeout(handleDisconnect, 2000); } }); connection.on('error', function(err) { if(err.code === 'PROTOCOL_CONNECTION_LOST') { handleDisconnect(); console.log('A conexão com MySQL foi perdida, porém um novo processo de conexão foi iniciado.'); } else { throw err; } }); } module.exports = function(app){ handleDisconnect(); Repository = {}; Repository.municipios = function(context, next){ let municipios = JSON.parse(fs.readFileSync(__dirname+'/../geospatial/goias.geojson', 'utf8')); context.municipios = municipios return next(); } Repository.db = function(context, next){ connection.query( 'SELECT Municipios.Municipio,\\ SchoolarData.Cod_Munic,\\ SchoolarData.Ano, \\ SchoolarData.Pop_0_3,\\ SchoolarData.Pop_4_5,\\ SchoolarData.Mat_Creche_Nun,\\ SchoolarData.Mat_Creche_Per,\\ SchoolarData.Mat_Pre_Esc_Nun,\\ SchoolarData.Mat_Pre_Esc_Per\\ FROM Municipios JOIN SchoolarData\\ ON Municipios.Cod_Munic = SchoolarData.Cod_Munic\\ ORDER BY SchoolarData.Ano DESC', function (error, results, fields) { if (error){ console.log(error); }else{ let mpdata = JSON.parse(JSON.stringify(results)); let modataparsed = parsedb.parse(mpdata); context.mpdata = modataparsed; next(); } }); } /*Retorna coleção de dados da tabela de dados dos transportes escolares dos municípios do Estado de Goiás */ Repository.dadosTransporte = function(context, next){ connection.query( 'SELECT Municipios.Municipio,\\ Transporte.id_transporte,\\ Transporte.ano,\\ Transporte.semestre, \\ Transporte.pp,\\ Transporte.aprov,\\ Transporte.reprov,\\ Transporte.nao_comp,\\ Transporte.total,\\ Transporte.p_aprov,\\ Transporte.p_reprov,\\ Transporte.p_naocomp,\\ Transporte.cod_municipio \\ FROM Municipios JOIN Transporte \\ ON Municipios.Cod_Munic = Transporte.cod_municipio \\ ORDER BY Transporte.ano DESC', function (error, results, fields) { if (error){ console.log(error); }else{ let mpdata = JSON.parse(JSON.stringify(results)); let modataparsed = parseTransporte.parse(mpdata); context.dadosTransporte = modataparsed; next(); } }); } /*Retorna coleção de dados da tabela de dados do financiamento escolar dos municípios do Estado de Goiás */ Repository.dadosFinanciamento = function(context, next){ connection.query( 'SELECT Municipios.Municipio,\\ Financiamento.id_financiamento,\\ Financiamento.ano,\\ Financiamento.item1_mde,\\ Financiamento.item1_fundeb,\\ Financiamento.itens3e4_mde_edu_inf,\\ Financiamento.itens3e4_mde_edu_fun,\\ Financiamento.itens3e4_fundeb_pag_mag,\\ Financiamento.itens3e4_fundeb_outras_desp,\\ Financiamento.dedu_const,\\ Financiamento.item2_perc_cert,\\ Financiamento.cod_municipio \\ FROM Municipios JOIN Financiamento \\ ON Municipios.Cod_Munic = Financiamento.cod_municipio \\ ORDER BY Financiamento.ano DESC', function (error, results, fields) { if (error){ console.log(error); }else{ let mpdata = JSON.parse(JSON.stringify(results)); let modataparsed = parseFinanciamento.parse(mpdata); context.dadoFinanciamento = modataparsed; next(); } }); } /*Retorna coleção de dados da tabela de dados do IDEB dos municípios do Estado de Goiás */ Repository.dadosIdeb = function(context, next){ connection.query( 'SELECT Municipios.Municipio,\\ Ideb.id_ideb,\\ Ideb.ano,\\ Ideb.classe,\\ Ideb.indice,\\ Ideb.meta,\\ Ideb.atingiu_meta,\\ Ideb.cod_municipio \\ FROM Municipios JOIN Ideb \\ ON Municipios.Cod_Munic = Ideb.cod_municipio \\ ORDER BY Ideb.ano DESC', function (error, results, fields) { if (error){ console.log(error); }else{ let mpdata = JSON.parse(JSON.stringify(results)); let modataparsed = parseIdeb.parse(mpdata); context.dadosIdeb = modataparsed; next(); } }); } /*Retorna coleção de dados da tabela de dados do IDEB dos municípios do Estado de Goiás */ Repository.mun = function(context, next){ connection.query( 'SELECT * \\ FROM Municipios ', function (error, results, fields) { if (error){ console.log(error); }else{ let mun = JSON.parse(JSON.stringify(results)); context.mun = mun; next(); } }); } return Repository; } × Search results Close "},"server_routers_geojson.js.html":{"id":"server_routers_geojson.js.html","title":"Source: server/routers/geojson.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/routers/geojson.js /** * @module server/routers/geojson * * @description Código de definição da rotas de acesso aos dados da educação, * que serão requisitados pelos clientes quando forem montar os mapas e gráficos * * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT */ module.exports = function(app) { var routerGeo = {} routerGeo.geojson = function(context, next){ app.get('/geojson', function(request, response){ response.send(context.municipios) }); app.get('/mpdata', function(request, response){ response.send(context.mpdata) }); app.get('/transporte', function(request, response){ response.send(context.dadosTransporte) }); app.get('/financiamento', function(request, response){ response.send(context.dadoFinanciamento) }); app.get('/ideb', function(request, response){ response.send(context.dadosIdeb) }); app.get('/mun', function(request, response){ response.send(context.mun) }); } return routerGeo; }; × Search results Close "},"server_utils_insereDadosFinanciamento.js.html":{"id":"server_utils_insereDadosFinanciamento.js.html","title":"Source: server/utils/insereDadosFinanciamento.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/utils/insereDadosFinanciamento.js #!/usr/bin/env node /** * @module server/utils/insereDadosFinanciamento * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT * * * @description Código responsável por ler um arquivo com os dados do Financiamento da Educação no formato CSV e * convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, * caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. * * OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. * * &lt;p&gt; * &lt;pre&gt; * ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- * | ano | item1_mde | item1_fundeb | itens3e4_mde_edu_inf | itens3e4_mde_edu_fun | itens3e4_fundeb_pag_mag | itens3e4_fundeb_outras_desp | dedu_const | item2_perc_cert | cod_municipio | * ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- * &lt;/pre&gt; * &lt;p&gt; * Comando para executar os programa de inserção do dados. * * &lt;pre&gt; * ./insereDadosFinanciamento.js dbhost dbuser dbpassword dbname financiamento.csv * &lt;/pre&gt; */ 'use strict'; const csv = require('csv-tools'); const mysql = require('mysql'); const dbhost = process.argv[2]; const dbuser = process.argv[3]; const dbpass = process.argv[4]; const dbname = process.argv[5]; const csvfn = process.argv[6]; /** * @function executaTransacaoDeArrayDeQuerys * * @description Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. * * @param {Object} connection Objeto de conxeção com mysql * @param {Array} arrayDeQuerys Lista de INSERTS */ function executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys){ /* Início da transação */ connection.beginTransaction(function(erro) { if (erro) { throw erro; } var registros = 0; arrayDeQuerys.forEach(function(value) { connection.query(value, function (erro, results, fields) { if (erro) { // console.log('Transação Abortada!'); connection.rollback(function() { console.log(\"\\n PROBLEMA NO REGISTRO: \"+ value + \"\\n\"); throw erro; }); return; } }); registros++; }); console.log(\"\\n TOTAL DE REGISTROS: \" + registros + \"\\n\"); connection.commit(function(erro) { if (erro) { console.log('Transação Abortada!'); connection.rollback(function() { throw erro; }); } connection.end(); }); }); /* Fim da transação */ } csv.fileToJSON(csvfn, function(json) { try { var connection = mysql.createConnection({ host : dbhost, user : dbuser, password : dbpass, database : dbname }); connection.connect((erro) =&gt; { if (erro) { console.error('Erro de conexão com banco de dados: ' + erro.stack); throw erro; } }); var arrayDeQuerys = []; json.forEach(function(value) { arrayDeQuerys.push(\"INSERT INTO Financiamento VALUES (NULL,\" +value.ano+\",\" +value.item1_mde+\",\" +value.item1_fundeb+\",\" +value.itens3e4_mde_edu_inf+\",\" +value.itens3e4_mde_edu_fun+\",\" +value.itens3e4_fundeb_pag_mag+\",\" +value.itens3e4_fundeb_outras_desp+\",\" +value.dedu_const+\",\" +value.item2_perc_cert+\",\" +value.cod_municipio+\")\"); }); executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys); } catch(erro){ console.log(\"\\n Erro: \" +erro+ \"\\n\"); } }); × Search results Close "},"server_utils_insereDadosIdeb.js.html":{"id":"server_utils_insereDadosIdeb.js.html","title":"Source: server/utils/insereDadosIdeb.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/utils/insereDadosIdeb.js #!/usr/bin/env node /** * @module server/utils/insereDadosIdeb * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT * * * @description Código responsável por ler um arquivo com os dados do IDEB no formato CSV e * convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, * caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. * * OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. * * &lt;p&gt; * &lt;pre&gt; * --------------------------------------------------------------------------- * | ano | classe | indice | meta | atingiu_meta | cod_municipio | * --------------------------------------------------------------------------- * &lt;/pre&gt; * &lt;p&gt; * Comando para executar os programa de inserção do dados. * * &lt;pre&gt; * ./insereDadosIdeb.js dbhost dbuser dbpassword dbname ideb.csv * &lt;/pre&gt; */ 'use strict'; const csv = require('csv-tools'); const mysql = require('mysql'); const dbhost = process.argv[2]; const dbuser = process.argv[3]; const dbpass = process.argv[4]; const dbname = process.argv[5]; const csvfn = process.argv[6]; /** * @function executaTransacaoDeArrayDeQuerys * * @description Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. * * @param {Object} connection Objeto de conxeção com mysql * @param {Array} arrayDeQuerys Lista de INSERTS */ function executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys){ /* Início da transação */ connection.beginTransaction(function(erro) { if (erro) { throw erro; } var registros = 0; arrayDeQuerys.forEach(function(value) { connection.query(value, function (erro, results, fields) { if (erro) { // console.log('Transação Abortada!'); connection.rollback(function() { console.log(\"\\n PROBLEMA NO REGISTRO: \"+ value + \"\\n\"); throw erro; }); return; } }); registros++; }); console.log(\"\\n TOTAL DE REGISTROS: \" + registros + \"\\n\"); connection.commit(function(erro) { if (erro) { console.log('Transação Abortada!'); connection.rollback(function() { throw erro; }); } connection.end(); }); }); /* Fim da transação */ } csv.fileToJSON(csvfn, function(json) { try { var connection = mysql.createConnection({ host : dbhost, user : dbuser, password : dbpass, database : dbname }); connection.connect((erro) =&gt; { if (erro) { console.error('Erro de conexão com banco de dados: ' + erro.stack); throw erro; } }); var arrayDeQuerys = []; json.forEach(function(value) { arrayDeQuerys.push(\"INSERT INTO Ideb VALUES (NULL,\" +value.ano+\",\" +\"'\" +value.classe+\"'\"+\",\" +value.indice+\",\" +value.meta+\",\" +value.atingiu_meta+\",\" +value.cod_municipio+\")\"); }); executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys); } catch(erro){ console.log(\"\\n Erro: \" +erro+ \"\\n\"); } }); × Search results Close "},"server_utils_insereDadosMatriculas.js.html":{"id":"server_utils_insereDadosMatriculas.js.html","title":"Source: server/utils/insereDadosMatriculas.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/utils/insereDadosMatriculas.js #!/usr/bin/env node /** * @module server/utils/insereDadosMatriculas * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT * * * @description Código responsável por ler um arquivo com os dados de Matrículas da Educação Infantil no formato CSV e * convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, * caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. * * OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. * * &lt;p&gt; * &lt;pre&gt; * ----------------------------------------------------------------------------------------------------------------------------- * | Ano | Pop_0_3 | Pop_4_5 | Mat_Creche_Nun | Mat_Creche_Per | Mat_Pre_Esc_Nun | Mat_Pre_Esc_Per | Cod_Munic | * ----------------------------------------------------------------------------------------------------------------------------- * &lt;/pre&gt; * &lt;p&gt; * Comando para executar os programa de inserção do dados. * * &lt;pre&gt; * ./insereDadosMatriculas.js dbhost dbuser dbpassword dbname matriculas.csv * &lt;/pre&gt; */ 'use strict'; const csv = require('csv-tools'); const mysql = require('mysql'); const dbhost = process.argv[2]; const dbuser = process.argv[3]; const dbpass = process.argv[4]; const dbname = process.argv[5]; const csvfn = process.argv[6]; /** * @function executaTransacaoDeArrayDeQuerys * * @description Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. * * @param {Object} connection Objeto de conxeção com mysql * @param {Array} arrayDeQuerys Lista de INSERTS */ function executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys){ /* Início da transação */ connection.beginTransaction(function(erro) { if (erro) { throw erro; } var registros = 0; arrayDeQuerys.forEach(function(value) { connection.query(value, function (erro, results, fields) { if (erro) { // console.log('Transação Abortada!'); connection.rollback(function() { console.log(\"\\n PROBLEMA NO REGISTRO: \"+ value + \"\\n\"); throw erro; }); return; } }); registros++; }); console.log(\"\\n TOTAL DE REGISTROS: \" + registros + \"\\n\"); connection.commit(function(erro) { if (erro) { console.log('Transação Abortada!'); connection.rollback(function() { throw erro; }); } connection.end(); }); }); /* Fim da transação */ } csv.fileToJSON(csvfn, function(json) { try { var connection = mysql.createConnection({ host : dbhost, user : dbuser, password : dbpass, database : dbname }); connection.connect((erro) =&gt; { if (erro) { console.error('Erro de conexão com banco de dados: ' + erro.stack); throw erro; } }); var arrayDeQuerys = []; json.forEach(function(value) { arrayDeQuerys.push(\"INSERT INTO SchoolarData VALUES (NULL,\" +value.Ano+\",\" +value.Pop_0_3+\",\" +value.Pop_4_5+\",\" +value.Mat_Creche_Nun+\",\" +value.Mat_Creche_Per+\",\" +value.Mat_Pre_Esc_Nun+\",\" +value.Mat_Pre_Esc_Per+\",\" +value.Cod_Munic+\")\"); }); executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys); } catch(erro){ console.log(\"\\n Erro: \" +erro+ \"\\n\"); } }); × Search results Close "},"server_utils_insereDadosTranporte.js.html":{"id":"server_utils_insereDadosTranporte.js.html","title":"Source: server/utils/insereDadosTranporte.js","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Source: server/utils/insereDadosTranporte.js #!/usr/bin/env node /** * @module server/utils/insereDadosTranporte * @version 1.0.0 * @author Tharles de Sousa Andrade * @copyright Copyright (c) 2019 Ministério Público do Estado de Goiás * @license MIT * * * @description Código responsável por ler um arquivo com os dados do Transporte Escolar no formato CSV e * convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, * caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. * &lt;br&gt; * OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. * * &lt;p&gt; * &lt;pre&gt; * ---------------------------------------------------------------------------------------------------------------------------------- * | ano | semestre | pp | aprov | reprov | nao_comp | total | p_aprov | p_reprov | p_naocomp | cod_municipio | * ---------------------------------------------------------------------------------------------------------------------------------- * &lt;/pre&gt; * &lt;p&gt; * Comando para executar os programa de inserção do dados. * * &lt;pre&gt; * ./insereDadosTransporte.js dbhost dbuser dbpassword dbname transporte.csv * &lt;/pre&gt; */ 'use strict'; const csv = require('csv-tools'); const mysql = require('mysql'); const dbhost = process.argv[2]; const dbuser = process.argv[3]; const dbpass = process.argv[4]; const dbname = process.argv[5]; const csvfn = process.argv[6]; /** * @function executaTransacaoDeArrayDeQuerys * * @description Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. * * @param {Object} connection Objeto de conxeção com mysql * @param {Array} arrayDeQuerys Lista de INSERTS */ function executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys){ /* Início da transação */ connection.beginTransaction(function(erro) { if (erro) { throw erro; } var registros = 0; arrayDeQuerys.forEach(function(value) { connection.query(value, function (erro, results, fields) { if (erro) { // console.log('Transação Abortada!'); connection.rollback(function() { console.log(\"\\n PROBLEMA NO REGISTRO: \"+ value + \"\\n\"); throw erro; }); return; } }); registros++; }); console.log(\"\\n TOTAL DE REGISTROS: \" + registros + \"\\n\"); connection.commit(function(erro) { if (erro) { console.log('Transação Abortada!'); connection.rollback(function() { throw erro; }); } connection.end(); }); }); /* Fim da transação */ } csv.fileToJSON(csvfn, function(json) { try { var connection = mysql.createConnection({ host : dbhost, user : dbuser, password : dbpass, database : dbname }); connection.connect((erro) =&gt; { if (erro) { console.error('Erro de conexão com banco de dados: ' + erro.stack); throw erro; } }); var arrayDeQuerys = []; json.forEach(function(value) { arrayDeQuerys.push(\"INSERT INTO Transporte VALUES (NULL,\" +value.ano+\",\" +value.semestre+\",\" +\"'\" +value.pp+\"'\"+\",\" +value.aprov+\",\" +value.reprov+\",\" +value.nao_comp+\",\" +value.total+\",\" +value.p_aprov+\",\" +value.p_reprov+\",\" +value.p_naocomp+\",\" +value.cod_municipio+\")\"); }); executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys); } catch(erro){ console.log(\"\\n Erro: \" +erro+ \"\\n\"); } }); × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Modules × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Plataforma de Espacialização dos Dados da Educação do Estado de GoiásEsta plataforma tem o objetivo de espacializar via WebGIS (Sistemas de Informações Geográficas em ambiente web), os dados: do financiamento da educação, do Índice de Desenvolvimento da Educação Básica (IDEB), das matrículas da educação infantil e do transporte escolar em mapas georreferenciados. Pré-requisitos [MySql] - Executar script localizado em database/querys/banco_geral.sql [Node.js] - Sugestão de Instalação descrita no próximo item. Instalação do Node.js via arquivo binário no linuxCrie o diretório do nodejs # mkdir -p /usr/local/lib/nodejsDescompacte o arquivo binário da última versão LTS disponível no diretório do nodejs criado anteriormente. /usr/local/lib/nodejs # tar -xJvf node-v10.15.1-linux-x64.tar.xz -C /usr/local/lib/nodejs Adicione as variáveis de ambiente no arquivo ~/.bashrc # nano ~/.bashrcCopie as linhas abaixo para o final do arquivo ~/.bashrc export VERSION=v10.15.1 export DISTRO=linux-x64 export PATH=/usr/local/lib/nodejs/node-$VERSION-$DISTRO/bin:$PATH alias node='/usr/local/lib/nodejs/node-$VERSION-$DISTRO/bin/node' alias npm='/usr/local/lib/nodejs/node-$VERSION-$DISTRO/bin/npm' alias npx='/usr/local/lib/nodejs/node-$VERSION-$DISTRO/bin/npx'Recarrege o arquivo # source ~/.bashrcTeste a instalação verificando as versões, conforme comandos abaixo # node -v # npm version # npx -vA saída normal seria: # node -v v8.11.4# npm version { npm: '5.6.0', ares: '1.10.1-DEV', cldr: '31.0.1', http_parser: '2.7.0', icu: '59.1', modules: '57', nghttp2: '1.25.0', node: '8.11.4', openssl: '1.0.2n', tz: '2017b', unicode: '9.0', uv: '1.15.0', v8: '6.1.534.50', zlib: '1.2.11' } Deployment Para iniciar o servidor você precisa acessar o diretório server/ e executar o comando abaixo no terminal Ambiente de produção: # nohup node main.js &amp;Ambiente de desenvolvimento: # node main.jsOBS: A execução do node com o comando (nohup e &amp; no final) faz com que a aplicação fique executando em background. Para acessar a aplicação digite o endereço abaixo no navegador: http://localhostDependências Node.js - Servidor web Leaflet - Biblioteca JavaScript de mapas interativos jsPDF - Biblioteca JavaScript para criação de arquivos PDF Plotly - Biblioteca JavaScript para criação de gráficos × Search results Close "},"module-client_lib_financiamento.html":{"id":"module-client_lib_financiamento.html","title":"Module: client/lib/financiamento","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/financiamento Financiamento da Educação Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/financiamento.js, line 1 Methods &lt;inner&gt; addLegend(map) Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/financiamento.js, line 80 &lt;inner&gt; calculaDifMdeEFundeb(eduInf, eduFun) → {Text} Esta função responsável por calcular a diferença entre os valores despesa de educação infantil e fundamental. Essa informação será exibido quando o usuário pairar o cursor do mouse sobre os valores de educação infantil e fundamental na janela de informações do município. Parameters: Name Type Description eduInf Number Valor da despesa de Educação Infantil. eduFun Number Valor da despesa de Educação Fundamental. Source: client/lib/financiamento.js, line 685 Returns: Html com resultado dentro de um componente tooltip. Type Text &lt;inner&gt; chartMaker() Esta função é responsável por gerar o gráfico de Receitas do MDE e FUNDEB do município Source: client/lib/financiamento.js, line 385 &lt;inner&gt; chartMakerDepesasEducacao() Esta função é responsável por gerar o gráfico de Despesas do MDE e FUNDEB do município Source: client/lib/financiamento.js, line 461 &lt;inner&gt; chartMakerOutrasInformacoes() Esta função é responsável por gerar o gráfico de Percentual Certificado do município Source: client/lib/financiamento.js, line 577 &lt;inner&gt; componentMaker() Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no banco de dados. Source: client/lib/financiamento.js, line 633 &lt;inner&gt; displayTabs(tab) Esta função controla os eventos de click das abas da tela de Financimento da Educação. Ao clicar sobre uma determinada aba, as outras serão ocultadas e somente a clicada será exposta. Parameters: Name Type Description tab HtmlElement ID da aba clicada. Source: client/lib/financiamento.js, line 38 &lt;inner&gt; getColorFromPercentual(perc) → {Text} Esta função responsável por definir a cor do valor de Percentual Certificado na janela de informações do município. Parameters: Name Type Description perc Number Valor do percentual certificado do municipio. Source: client/lib/financiamento.js, line 714 Returns: Cor conforme percentual informando Type Text &lt;inner&gt; getDeducoesConstituicionais(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Deduções Constitucionais (dedu_const). Parameters: Name Type Description list Array lista de informações do município. Source: client/lib/financiamento.js, line 349 Returns: Valor das Deduções Constitucionais. Type Number &lt;inner&gt; getDespesaFundebOutrasDespesas(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Despesa do FUNDEB com Outras Despesas (itens3e4_fundeb_outras_desp). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/financiamento.js, line 331 Returns: Valor da Despesa do FUNDEB com Outras Despesas. Type Number &lt;inner&gt; getDespesaFundebPagMagisterio(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Despesa do FUNDEB com Magistério (itens3e4_fundeb_pag_mag). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/financiamento.js, line 313 Returns: Valor da Despesa do FUNDEB com Magistério. Type Number &lt;inner&gt; getDespesaMdeEducacaoFundamental(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Despesa do MDE em Educação Fundamental (itens3e4_mde_edu_fun). Parameters: Name Type Description list Array lista de informações do município. Source: client/lib/financiamento.js, line 295 Returns: Valor da Despesa do MDE em Educação Fundamental. Type Number &lt;inner&gt; getDespesaMdeEducacaoInfantil(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Despesa do MDE em Educação Infantil (itens3e4_mde_edu_inf). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/financiamento.js, line 277 Returns: Valor da Despesa do MDE em Educação Infantil. Type Number &lt;inner&gt; getFeature(feature) → {Object} Esta função é reponsável por capturar o objeto referente a área do município (feature) do objeto geoJSON. Parameters: Name Type Description feature Object Área do município Source: client/lib/financiamento.js, line 25 Returns: Área do município. Type Object &lt;inner&gt; getPercentualCertificado(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Pecentual Certificado (item2_perc_cert). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/financiamento.js, line 367 Returns: Valor do Percentual Certificado. Type Number &lt;inner&gt; getReceitaFundeb(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Receita do FUNDEB (item1_fundeb). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/financiamento.js, line 259 Returns: Valor da Receita do FUNDEB. Type Number &lt;inner&gt; getReceitaMde(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente a Receita do MDE (item1_mde). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/financiamento.js, line 241 Returns: Valor da Receita do MDE. Type Number &lt;inner&gt; getStyleFromPercentualCertificado(aggregateDataByyear, value) → {Object} Esta função é reponsável por definir a cor da área (polígono) do município no mapa conforme o percentual certificado. do objeto geoJSON. Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município filtradas por ano. value Number Valor do percentual do município Source: client/lib/financiamento.js, line 142 Returns: Objeto com as informações do estilo do município. Type Object &lt;inner&gt; getYear(list, year) → {Array} Esta função é reponsável por filtrar as informações do município pelo ano informado na chamada do método. Parameters: Name Type Description list Array Lista com os municípios do estado year Number Ano selecionado Source: client/lib/financiamento.js, line 122 Returns: Lista de informações do município filtradas por ano. Type Array &lt;inner&gt; getYearsFromMun(list) → {Array} Esta função responsável por filtrar da lista de informações classificadas por ano, os anos de um determinado município. Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/financiamento.js, line 222 Returns: Lista de anos do município. Type Array &lt;inner&gt; initMap(map) Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, neste caso, na div identificada pelo id mapid. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/financiamento.js, line 859 &lt;inner&gt; montaTabelaPopUpFinanciamento(aggregateDataByyear, la) → {text} Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município filtradas por ano. la Object (layer) camada de exibição do mapa. Source: client/lib/financiamento.js, line 733 Returns: Tabela em html com as informaçãos do município. Type text &lt;inner&gt; poligonMap(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/financiamento.js, line 805 &lt;inner&gt; promise() O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, busca-se os dados do financimento da educação e depois é realizado a ordenação deles. Source: client/lib/financiamento.js, line 898 &lt;inner&gt; setLayer(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, quando houver troca de ano. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/financiamento.js, line 837 &lt;inner&gt; sliderStepDynamics(map) Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Financimento da Educação. Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente ao ano selecionado. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/financiamento.js, line 106 &lt;inner&gt; styleMap(feat) → {Object} Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. Parameters: Name Type Description feat Object Feature do município. Source: client/lib/financiamento.js, line 192 Returns: Objeto com as informações do estilo do município. Type Object &lt;inner&gt; toImage() → {Text} O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF do relatório do Financimento da Educação - Despesas do MDE e FUNDEB. Será criado um input do tipo hidden para guardar essa string e posteriormente ser capturada pelo gerador de PDF. Source: client/lib/financiamento.js, line 562 Returns: Imagem em base64 Type Text &lt;inner&gt; toImage() → {Text} O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF do relatório do Financimento da Educação - Receitas do MDE e FUNDEB. Será criado um input do tipo hidden para guardar essa string e posteriormente ser capturada pelo gerador de PDF. Source: client/lib/financiamento.js, line 446 Returns: Imagem em base64 Type Text &lt;inner&gt; toImage() → {Text} O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF do relatório do Financimento da Educação - Percentual Certificado. Será criado um input do tipo hidden para guardar essa string e posteriormente ser capturada pelo gerador de PDF. Source: client/lib/financiamento.js, line 617 Returns: Imagem em base64 Type Text × Search results Close "},"module-client_lib_ideb.html":{"id":"module-client_lib_ideb.html","title":"Module: client/lib/ideb","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/ideb Dados do IDEB Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/ideb.js, line 1 Methods &lt;inner&gt; addLegend(map) Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/ideb.js, line 59 &lt;inner&gt; chartMaker() Esta função é responsável por gerar o gráfico da situação do município no IDEB Source: client/lib/ideb.js, line 290 &lt;inner&gt; componentMaker() Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no banco de dados. Source: client/lib/ideb.js, line 363 &lt;inner&gt; getAtingiuMeta(list) → {Text} Esta função responsável por filtrar da lista de informações do município, o valor correspondente do atributo atingiu nota (atingiu_meta). Parameters: Name Type Description list Array lista de informações do município. Source: client/lib/ideb.js, line 268 Returns: Atributo que consta se a nota foi atingida ou não. Type Text &lt;inner&gt; getColorFromMeta(meta) → {Text} Parameters: Name Type Description meta Number Valor da meta Source: client/lib/ideb.js, line 431 Returns: Oor conforme a meta atingida ou não Type Text &lt;inner&gt; getFeature(feature) → {Object} Esta função é reponsável por capturar o objeto referente a área do município (feature) do objeto geoJSON. Parameters: Name Type Description feature Object Área do município Source: client/lib/ideb.js, line 25 Returns: feature (área do município) Type Object &lt;inner&gt; getIDEB(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente da nota do IDEB (indice). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/ideb.js, line 222 Returns: Nota do IDEB. Type Number &lt;inner&gt; getLegend() → {text} Esta função é responsável por montar a legenda de dados do mapa. Source: client/lib/ideb.js, line 39 Returns: legenda do mapa em html Type text &lt;inner&gt; getMeta(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente da meta do IDEB (meta). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/ideb.js, line 246 Returns: Meta do IDEB. Type Number &lt;inner&gt; getMunicipioPorClasse(mun) → {Boolean} Esta função responsável por filtar municipios por classe (Etapa Escolar) Parameters: Name Type Description mun Obejct Objeto do municipio Source: client/lib/ideb.js, line 703 Returns: true / false Type Boolean &lt;inner&gt; getStyleAtingiuMeta(aggregateDataByyear) → {Object} Esta função é reponsável por definir a cor da área (polígono) do município no mapa. Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município filtradas por ano. Source: client/lib/ideb.js, line 129 Returns: Objeto com as informações do estilo do município. Type Object &lt;inner&gt; getTextMeta(meta) → {Text} Parameters: Name Type Description meta Number Valor da meta. Source: client/lib/ideb.js, line 413 Returns: texto se meta for {0 - Não / 1 - Sim} Type Text &lt;inner&gt; getYear(list, year) → {Array} Esta função é reponsável por filtrar as informações do município pelo ano informado e pela classe (Etapa Escolar) na chamada do método. Parameters: Name Type Description list Array Lista com os municípios do estado year Number Ano selecionado Source: client/lib/ideb.js, line 94 Returns: list lista de informações do município filtradas por ano. Type Array &lt;inner&gt; getYearsFromMun(list) → {Array} Esta função responsável por filtrar da lista de informações classificadas por ano, os anos de um determinado município. Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/ideb.js, line 199 Returns: Lista anos do município. Type Array &lt;inner&gt; initMap(map) Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, neste caso, na div identificada pelo id mapid. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/ideb.js, line 543 &lt;inner&gt; montaTabelaPopUpIdeb(aggregateDataByyear, la) → {Text} Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município filtradas por ano. la Object Camada (layer) de exibição do mapa Source: client/lib/ideb.js, line 446 Returns: Tabela em html com as informaçãos do município. Type Text &lt;inner&gt; poligonMap(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/ideb.js, line 489 &lt;inner&gt; promise() O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, busca-se os dados do IDEB e depois será realizado a ordenação deles. Source: client/lib/ideb.js, line 577 &lt;inner&gt; setLayer(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, quando houver troca de ano. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/ideb.js, line 516 &lt;inner&gt; sliderStepDynamics(map) Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Financimento da Educação. Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente ao ano selecionado. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/ideb.js, line 78 &lt;inner&gt; styleMap(feat) → {object} Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. Parameters: Name Type Description feat Object Feature do município. Source: client/lib/ideb.js, line 163 Returns: Objeto com informações do estilo do município. Type object &lt;inner&gt; toImage() → {Text} O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF do relatório do IDEB. Será criado um input do tipo hidden para guardar essa string e posteriormente ser capturada pelo gerador de PDF. Source: client/lib/ideb.js, line 347 Returns: Imagem em base64 Type Text × Search results Close "},"module-client_lib_matriculas.html":{"id":"module-client_lib_matriculas.html","title":"Module: client/lib/matriculas","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/matriculas Matrículas da Educação Infantil Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/matriculas.js, line 1 Methods &lt;inner&gt; addLegend(map) Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/matriculas.js, line 41 &lt;inner&gt; chartMaker() Esta função é responsável por gerar o gráfico de Percentuais de matrículas Creches e Pré-escolas do município Source: client/lib/matriculas.js, line 336 &lt;inner&gt; componentMaker(mymap) Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no banco de dados. Parameters: Name Type Description mymap Object Objeto Leaflet que cria o mapa. Source: client/lib/matriculas.js, line 407 &lt;inner&gt; getColorFromMatriculas(percentual) → {text} Parameters: Name Type Description percentual Number Percentual utilizado para definição das cores das features Source: client/lib/matriculas.js, line 462 Returns: Cor em hexadecimal ou texto conforme o percentual de creches ou pré-escolas Type text &lt;inner&gt; getCreche(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente ao percentual de matrículas em creches (Mat_Creche_Per). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/matriculas.js, line 299 Returns: Percentual de matrículas em creches. Type Number &lt;inner&gt; getFeature(feature) → {Object} Esta função é reponsável por capturar o objeto referente a área do município (feature) do objeto geoJSON. Parameters: Name Type Description feature Object Área do município Source: client/lib/matriculas.js, line 27 Returns: Área do município. Type Object &lt;inner&gt; getPreEscola(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente ao percentual de matrículas em pré-escolas (Mat_Pre_Esc_Per). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/matriculas.js, line 317 Returns: Percentual de matrículas em pré-escolas. Type Number &lt;inner&gt; getStyleFromTypeMatricula(aggregateDataByyear, value) → {Object} Esta função é reponsável por definir a cor da área (polígono) do município no mapa conforme o tipo de matrícula . Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município filtradas por ano. value Number Valor do percentual selecionado. Source: client/lib/matriculas.js, line 119 Returns: Objeto com Parâmetros para estilização das áres dos municípios. Type Object &lt;inner&gt; getValorAbsolutoDeTiposDeMatricula(aggregateDataByyear) → {Number} Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município. Source: client/lib/matriculas.js, line 506 Returns: Valores absolutos Type Number &lt;inner&gt; getYear(list, year) → {Array} Esta função é reponsável por filtrar as informações do município pelo ano informado na chamada do método. Parameters: Name Type Description list Array Lista com os municípios do estado year Number Ano selecionado Source: client/lib/matriculas.js, line 99 Returns: Lista de informações do município filtradas por ano. Type Array &lt;inner&gt; getYearsFromMun(list) → {Array} Esta função responsável por filtrar da lista de informações classificadas por ano, os anos de um determinado município. Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/matriculas.js, line 280 Returns: Lista anos do município. Type Array &lt;inner&gt; initMap(map) Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, neste caso, na div identificada pelo id mapid. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/matriculas.js, line 638 &lt;inner&gt; montaTabelaPopUpIdeb(aggregateDataByyear, la) → {Text} Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. Parameters: Name Type Description aggregateDataByyear array Lista de informações do município filtradas por ano. la Object (layer) camada de exibição do mapa Source: client/lib/matriculas.js, line 543 Returns: Html com tabela em html com as informaçãos do município. Type Text &lt;inner&gt; poligonMap(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/matriculas.js, line 591 &lt;inner&gt; promise() O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, busca-se os dados de de matrículas da educação infantil em creches e ṕré-escolas e depois será realizado a ordenação deles. Source: client/lib/matriculas.js, line 671 &lt;inner&gt; setLayer(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, quando houver troca de ano. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/matriculas.js, line 615 &lt;inner&gt; sliderStepDynamics(map) Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Matrículas da Educação Infantil Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente ao ano selecionado. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/matriculas.js, line 83 &lt;inner&gt; styleMap(feat) → {object} Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. Parameters: Name Type Description feat object Feature do município. Source: client/lib/matriculas.js, line 249 Returns: Objeto com informações do estilo do município. Type object &lt;inner&gt; toImage() → {Text} O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF do relatório de Matrículas da Educação Infantil. Será criado um input do tipo hidden para guardar essa string e posteriormente ser capturada pelo gerador de PDF. Source: client/lib/matriculas.js, line 391 Returns: Imagem em base64 Type Text × Search results Close "},"module-client_lib_pdf_geraDocumentoPdfFinanciamento.html":{"id":"module-client_lib_pdf_geraDocumentoPdfFinanciamento.html","title":"Module: client/lib/pdf/geraDocumentoPdfFinanciamento","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/pdf/geraDocumentoPdfFinanciamento Relatório do Financimento da Educação em PDF Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/pdf/geraDocumentoPdfFinanciamento.js, line 1 Methods &lt;inner&gt; dataFormatada(data, horas) → {Date} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description data Date Data do sistema horas boolean Se passar true, a função retornará a data com as horas Source: client/lib/pdf/geraDocumentoPdfFinanciamento.js, line 12 Returns: [data formatada no padrão brasileiro] Type Date &lt;inner&gt; formataDadosParaTabela(dados) → {array} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description dados array Informações do município sobre o Financimento da Educação Source: client/lib/pdf/geraDocumentoPdfFinanciamento.js, line 39 Returns: Lista de dados formatados conforme os requisitos do plugin jsPDF Type array &lt;inner&gt; geraPDF(dados, municipio) → {PDF} Esta função gera o PDF transformado os dados da tabela em html para tabela JSON Parameters: Name Type Description dados array Dados que irão compor a tabela municipio string Nome do município Source: client/lib/pdf/geraDocumentoPdfFinanciamento.js, line 91 Returns: Type PDF × Search results Close "},"module-client_lib_pdf_geraDocumentoPdfIdeb.html":{"id":"module-client_lib_pdf_geraDocumentoPdfIdeb.html","title":"Module: client/lib/pdf/geraDocumentoPdfIdeb","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/pdf/geraDocumentoPdfIdeb Relatório do IDEB em PDF. Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/pdf/geraDocumentoPdfIdeb.js, line 1 Methods &lt;inner&gt; dataFormatada(data, horas) → {Date} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description data d Data do sistema horas boolean Se passar true, a função retornará a data com as horas Source: client/lib/pdf/geraDocumentoPdfIdeb.js, line 12 Returns: Data formatada no padrão brasileiro] Type Date &lt;inner&gt; formataDadosParaTabela(dados) → {array} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description dados array Informações do município sobre o IDEB Source: client/lib/pdf/geraDocumentoPdfIdeb.js, line 39 Returns: Lista de dados formatados conforme os requisitos do plugin jsPDF Type array &lt;inner&gt; geraPDF(dados, municipio, etapa) → {PDF} Esta função gera o PDF transformado os dados da tabela em html para tabela JSON Parameters: Name Type Description dados array Dados que irão compor a tabela municipio string Nome do município etapa string Etapa escolar Source: client/lib/pdf/geraDocumentoPdfIdeb.js, line 79 Returns: Type PDF × Search results Close "},"module-client_lib_pdf_geraDocumentoPdfMatriculas.html":{"id":"module-client_lib_pdf_geraDocumentoPdfMatriculas.html","title":"Module: client/lib/pdf/geraDocumentoPdfMatriculas","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/pdf/geraDocumentoPdfMatriculas Relatório Matrículas da Educação Infantil em PDF. Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/pdf/geraDocumentoPdfMatriculas.js, line 1 Methods &lt;inner&gt; dataFormatada(data, horas) → {Date} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description data d Data do sistema horas boolean Se essa parâmentro receber true, a função retornará a data com as horas Source: client/lib/pdf/geraDocumentoPdfMatriculas.js, line 12 Returns: data Data formatada no padrão brasileiro Type Date &lt;inner&gt; formataDadosParaTabela(dados) → {array} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description dados array Informações do município sobre o Matrículas da Educação Infantil Source: client/lib/pdf/geraDocumentoPdfMatriculas.js, line 41 Returns: res Lista dados formatado conforme os requisitos do plugin jsPDF Type array &lt;inner&gt; geraPDF(dados, municipio) → {PDF} Esta função gera o PDF transformado os dados da tabela em html para tabela JSON Parameters: Name Type Description dados array Dados que irão compor a tabela municipio string Nome do município Source: client/lib/pdf/geraDocumentoPdfMatriculas.js, line 87 Returns: Type PDF × Search results Close "},"module-client_lib_pdf_geraDocumentoPdfTransporte.html":{"id":"module-client_lib_pdf_geraDocumentoPdfTransporte.html","title":"Module: client/lib/pdf/geraDocumentoPdfTransporte","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/pdf/geraDocumentoPdfTransporte Relatório do Transporte Escolar em PDF Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/pdf/geraDocumentoPdfTransporte.js, line 1 Methods &lt;inner&gt; dataFormatada(data, horas) → {Date} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description data d Data do sistema horas boolean Se essa parâmentro receber true, a função retornará a data com as horas Source: client/lib/pdf/geraDocumentoPdfTransporte.js, line 12 Returns: data Data formatada no padrão brasileiro Type Date &lt;inner&gt; formataDadosParaTabela(dados) → {array} Função responsável por definir as colunas da tabela e ordenar os valores por ano de forma decrescente. Parameters: Name Type Description dados array Informações do município sobre o Transporte Escolar Source: client/lib/pdf/geraDocumentoPdfTransporte.js, line 69 Returns: res Lista de dados formatados conforme os requisitos do plugin jsPDF Type array &lt;inner&gt; geraPDF(dados, municipio) → {PDF} Esta função gera o PDF transformado os dados da tabela em html para tabela JSON Parameters: Name Type Description dados array { dados que irão compor a tabela } municipio string { nome do município } Source: client/lib/pdf/geraDocumentoPdfTransporte.js, line 120 Returns: Type PDF &lt;inner&gt; getPercentuaFormatado(percentual) → {number} Parameters: Name Type Description percentual value Source: client/lib/pdf/geraDocumentoPdfTransporte.js, line 58 Returns: percentual formatado Type number &lt;inner&gt; getTextoPP(pp) → {string} Parameters: Name Type Description pp string Participação da promotoria Source: client/lib/pdf/geraDocumentoPdfTransporte.js, line 41 Returns: texto Type string × Search results Close "},"module-client_lib_transporte.html":{"id":"module-client_lib_transporte.html","title":"Module: client/lib/transporte","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/transporte Transporte Escolar Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/transporte.js, line 1 Methods &lt;inner&gt; addLegend(map) Esta função é responsável por adicionar a legenda no canto inferior direito do mapa. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/transporte.js, line 39 &lt;inner&gt; chartMaker() Esta função é responsável por gerar o gráfico de Vistoria do transporte escolar dos municípios Source: client/lib/transporte.js, line 306 &lt;inner&gt; componentMaker() Esta função é reponsável por montar a barra de anos abaixo do mapa conforme as informações existentes no banco de dados. Source: client/lib/transporte.js, line 394 &lt;inner&gt; getColorFromPercentualAprovado(percentual) → {Text} Parameters: Name Type Description percentual Number Percentual Aprovado Source: client/lib/transporte.js, line 443 Returns: Cor conforme o percentual aprovado Type Text &lt;inner&gt; getFeature(feature) → {Object} Esta função é reponsável por capturar o objeto referente a área do município (feature) do objeto geoJSON. Parameters: Name Type Description feature Object Área do município Source: client/lib/transporte.js, line 25 Returns: Área do município. Type Object &lt;inner&gt; getMunicipioPorSemestre(mun) → {Boolean} Esta função responsável por filtar municipios por semestre Parameters: Name Type Description mun Object Municipio Source: client/lib/transporte.js, line 742 Returns: (true / false) Type Boolean &lt;inner&gt; getPercentualAprovado(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente ao percentual aprovado (p_aprov). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/transporte.js, line 239 Returns: Percentual aprovado. Type Number &lt;inner&gt; getPercentualNaoCompareceu(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente ao percentual de veículos que não compareceram a vistoria (p_naocomp). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/transporte.js, line 284 Returns: Percentual de veículos que não compareceram a vistoria. Type Number &lt;inner&gt; getPercentualReprovado(list) → {Number} Esta função responsável por filtrar da lista de informações do município, o valor correspondente ao percentual reprovado (p_reprov). Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/transporte.js, line 262 Returns: Percentual reprovado. Type Number &lt;inner&gt; getStylePercentualAprovado(aggregateDataByyear) → {Object} Esta função é reponsável por definir a cor da área (polígono) do município no mapa conforme o percentual aprovado. Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município filtradas por ano. Source: client/lib/transporte.js, line 118 Returns: Objeto com parâmetros para estilização das áres dos municípios. Type Object &lt;inner&gt; getYear(list, year) → {Array} Esta função é reponsável por filtrar as informações do município pelo ano e semestre selecionado. Parameters: Name Type Description list Array Lista com os municípios do estado year Number Ano selecionado Source: client/lib/transporte.js, line 84 Returns: Lista de informações do município filtradas por ano e semestre. Type Array &lt;inner&gt; getYearsFromMun(list) → {Array} Esta função responsável por filtrar da lista de informações classificadas por ano, os anos de um determinado município. Parameters: Name Type Description list Array Lista de informações do município. Source: client/lib/transporte.js, line 216 Returns: Lista anos do município. Type Array &lt;inner&gt; initMap(map) Esta função responsável por criar o mapa por meio do plugin Leaflet no local especificado na página, neste caso, na div identificada pelo id mapid. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/transporte.js, line 581 &lt;inner&gt; montaTabelaPopUpIdeb(aggregateDataByyear, la) → {Text} Esta função responsável por montar a tabela de informações do município na janela acionada pelo PopUp. Parameters: Name Type Description aggregateDataByyear Array Lista de informações do município filtradas por ano. la Object Camada(layer) de exibição do mapa Source: client/lib/transporte.js, line 470 Returns: Tabela em html com as informaçãos do município. Type Text &lt;inner&gt; poligonMap(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/transporte.js, line 531 &lt;inner&gt; promise() O trecho de código abaixo controla praticamente todo fluxo da página, iniciando pela declaração da promise que busca via Ajax pelo método GET as features (polígonos dos municípios). Em seguida, pela mesma forma, busca-se os dados do Transporte Escolar e depois será realizado a ordenação deles. Source: client/lib/transporte.js, line 615 &lt;inner&gt; setLayer(map) Esta função responsável por definir as áreas (polígonos) dos municípios do estado no mapa, quando houver troca de ano. Parameters: Name Type Description map Object Objeto Leaflet. Source: client/lib/transporte.js, line 558 &lt;inner&gt; sliderStepDynamics(map) Esta função é responsável por capturar qualquer alteração na barra de anos localizado abaixo do mapa de Matrículas da Educação Infantil Caso haja alguma mudança de ano, será chamado o método que exibirá uma nova camada com os dados correspondente ao ano selecionado. Parameters: Name Type Description map Object Objeto Leaflet Source: client/lib/transporte.js, line 66 &lt;inner&gt; styleMap(feat) → {object} Esta função define o estilo {cor, borda, opacidade e etc.} dos municípios apresentado no mapa. Parameters: Name Type Description feat object Feature do município. Source: client/lib/transporte.js, line 186 Returns: Objeto com informações do estilo do município. Type object &lt;inner&gt; toImage() → {Text} O trecho de código a seguir, criar a imagem do gráfico para ser utilizado pelo programa gerador de PDF do relatório do Transporte Escolar. Será criado um input do tipo hidden para guardar essa string e posteriormente ser capturada pelo gerador de PDF. Source: client/lib/transporte.js, line 378 Returns: Imagem em base64 Type Text × Search results Close "},"module-client_lib_util.html":{"id":"module-client_lib_util.html","title":"Module: client/lib/util","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: client/lib/util Funções globais Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Tharles de Sousa Andrade License: MIT Source: client/lib/util.js, line 1 Methods &lt;inner&gt; converterFloatReal(valor) → {number} Parameters: Name Type Description valor number Valor no formato americano Source: client/lib/util.js, line 12 Returns: valor valor no formato brasileiro Type number &lt;inner&gt; setEventMouseOverOnLayer(layer, map) Função responsável por habilitar o evento que monitora quando o cursor do mouse paira sobre algum município, acionando o PopUp com as informações do município que está sobre. Parameters: Name Type Description layer object Camada de exibição do mapa map object objeto do mapa Source: client/lib/util.js, line 64 × Search results Close "},"module-server_main.html":{"id":"module-server_main.html","title":"Module: server/main","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/main Servidor da Aplicação, responsável por iniciar os serviços que serão requisitado pelos clientes. Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/main.js, line 1 Members &lt;inner, constant&gt; debug Configurações para debug do programa Source: server/main.js, line 30 &lt;inner&gt; express Declaração das dependências utilizadas no servidor Source: server/main.js, line 16 × Search results Close "},"module-server_middleware_parsedb.html":{"id":"module-server_middleware_parsedb.html","title":"Module: server/middleware/parsedb","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/middleware/parsedb Script encarregado de agrupar todas as informações oriundas da tabela de Matrículas da Educação Infantil de um determinado município em um objeto. Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/middleware/parsedb.js, line 1 × Search results Close "},"module-server_middleware_parseFinanciamento.html":{"id":"module-server_middleware_parseFinanciamento.html","title":"Module: server/middleware/parseFinanciamento","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/middleware/parseFinanciamento Script encarregado de agrupar todas as informações oriundas da tabela de Fiananciemento da Educação de um determinado município em um objeto. Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/middleware/parseFinanciamento.js, line 1 × Search results Close "},"module-server_middleware_parseIdeb.html":{"id":"module-server_middleware_parseIdeb.html","title":"Module: server/middleware/parseIdeb","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/middleware/parseIdeb Script encarregado de agrupar todas as informações oriundas da tabela de IDEB de um determinado município em um objeto. Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/middleware/parseIdeb.js, line 1 × Search results Close "},"module-server_middleware_parseTransporte.html":{"id":"module-server_middleware_parseTransporte.html","title":"Module: server/middleware/parseTransporte","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/middleware/parseTransporte Script encarregado de agrupar todas as informações oriundas da tabela de Transporte Escolar de um determinado município em um objeto. Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/middleware/parseTransporte.js, line 1 × Search results Close "},"module-server_middleware_repository.html":{"id":"module-server_middleware_repository.html","title":"Module: server/middleware/repository","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/middleware/repository Módulo de acesso ao Banco de dados e busca das informações das informações Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/middleware/repository.js, line 1 Methods &lt;inner&gt; handleDisconnect() Função encarregada de realizar a conexão com o banco de dados. Source: server/middleware/repository.js, line 27 × Search results Close "},"module-server_routers_geojson.html":{"id":"module-server_routers_geojson.html","title":"Module: server/routers/geojson","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/routers/geojson Código de definição da rotas de acesso aos dados da educação, que serão requisitados pelos clientes quando forem montar os mapas e gráficos Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/routers/geojson.js, line 1 × Search results Close "},"module-server_utils_insereDadosFinanciamento.html":{"id":"module-server_utils_insereDadosFinanciamento.html","title":"Module: server/utils/insereDadosFinanciamento","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/utils/insereDadosFinanciamento Código responsável por ler um arquivo com os dados do Financiamento da Educação no formato CSV e convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ano | item1_mde | item1_fundeb | itens3e4_mde_edu_inf | itens3e4_mde_edu_fun | itens3e4_fundeb_pag_mag | itens3e4_fundeb_outras_desp | dedu_const | item2_perc_cert | cod_municipio | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Comando para executar os programa de inserção do dados. ./insereDadosFinanciamento.js dbhost dbuser dbpassword dbname financiamento.csv Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/utils/insereDadosFinanciamento.js, line 3 Methods &lt;inner&gt; executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys) Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. Parameters: Name Type Description connection Object Objeto de conxeção com mysql arrayDeQuerys Array Lista de INSERTS Source: server/utils/insereDadosFinanciamento.js, line 44 × Search results Close "},"module-server_utils_insereDadosIdeb.html":{"id":"module-server_utils_insereDadosIdeb.html","title":"Module: server/utils/insereDadosIdeb","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/utils/insereDadosIdeb Código responsável por ler um arquivo com os dados do IDEB no formato CSV e convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. --------------------------------------------------------------------------- | ano | classe | indice | meta | atingiu_meta | cod_municipio | --------------------------------------------------------------------------- Comando para executar os programa de inserção do dados. ./insereDadosIdeb.js dbhost dbuser dbpassword dbname ideb.csv Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/utils/insereDadosIdeb.js, line 3 Methods &lt;inner&gt; executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys) Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. Parameters: Name Type Description connection Object Objeto de conxeção com mysql arrayDeQuerys Array Lista de INSERTS Source: server/utils/insereDadosIdeb.js, line 45 × Search results Close "},"module-server_utils_insereDadosMatriculas.html":{"id":"module-server_utils_insereDadosMatriculas.html","title":"Module: server/utils/insereDadosMatriculas","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/utils/insereDadosMatriculas Código responsável por ler um arquivo com os dados de Matrículas da Educação Infantil no formato CSV e convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. ----------------------------------------------------------------------------------------------------------------------------- | Ano | Pop_0_3 | Pop_4_5 | Mat_Creche_Nun | Mat_Creche_Per | Mat_Pre_Esc_Nun | Mat_Pre_Esc_Per | Cod_Munic | ----------------------------------------------------------------------------------------------------------------------------- Comando para executar os programa de inserção do dados. ./insereDadosMatriculas.js dbhost dbuser dbpassword dbname matriculas.csv Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/utils/insereDadosMatriculas.js, line 3 Methods &lt;inner&gt; executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys) Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. Parameters: Name Type Description connection Object Objeto de conxeção com mysql arrayDeQuerys Array Lista de INSERTS Source: server/utils/insereDadosMatriculas.js, line 44 × Search results Close "},"module-server_utils_insereDadosTranporte.html":{"id":"module-server_utils_insereDadosTranporte.html","title":"Module: server/utils/insereDadosTranporte","body":" Plataforma de Espacialização de Dados da Educação do Estado de Goiás Modules client/lib/financiamentoclient/lib/idebclient/lib/matriculasclient/lib/pdf/geraDocumentoPdfFinanciamentoclient/lib/pdf/geraDocumentoPdfIdebclient/lib/pdf/geraDocumentoPdfMatriculasclient/lib/pdf/geraDocumentoPdfTransporteclient/lib/transporteclient/lib/utilserver/mainserver/middleware/parsedbserver/middleware/parseFinanciamentoserver/middleware/parseIdebserver/middleware/parseTransporteserver/middleware/repositoryserver/routers/geojsonserver/utils/insereDadosFinanciamentoserver/utils/insereDadosIdebserver/utils/insereDadosMatriculasserver/utils/insereDadosTranporte Module: server/utils/insereDadosTranporte Código responsável por ler um arquivo com os dados do Transporte Escolar no formato CSV e convertê-lo em instruções de inserção SQL. Apos a conversão, as inserções serão executadas por meio de uma transação, caso tenha algum problema em alguma linha ou erro não serão inseridos nenhum registro. OBS: o cabeçalho do arquivo CSV deve ser obrigatoriamente igual as colunas da tabala abaixo. ---------------------------------------------------------------------------------------------------------------------------------- | ano | semestre | pp | aprov | reprov | nao_comp | total | p_aprov | p_reprov | p_naocomp | cod_municipio | ---------------------------------------------------------------------------------------------------------------------------------- Comando para executar os programa de inserção do dados. ./insereDadosTransporte.js dbhost dbuser dbpassword dbname transporte.csv Version: 1.0.0 Author: Tharles de Sousa Andrade Copyright: Copyright (c) 2019 Ministério Público do Estado de Goiás License: MIT Source: server/utils/insereDadosTranporte.js, line 4 Methods &lt;inner&gt; executaTransacaoDeArrayDeQuerys(connection, arrayDeQuerys) Função responsável por executar todas as instruções SQL de inserção dentro de uma transação. Parameters: Name Type Description connection Object Objeto de conxeção com mysql arrayDeQuerys Array Lista de INSERTS Source: server/utils/insereDadosTranporte.js, line 45 × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
